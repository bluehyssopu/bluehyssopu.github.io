<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>客怎眠qvq</title>
  
  <subtitle>某菜鸟的小屋</subtitle>
  <link href="https://www.kzmqvq.com/atom.xml" rel="self"/>
  
  <link href="https://www.kzmqvq.com/"/>
  <updated>2024-04-26T01:37:42.533Z</updated>
  <id>https://www.kzmqvq.com/</id>
  
  <author>
    <name>客怎眠qvq</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【随手记】Nginx配置详解</title>
    <link href="https://www.kzmqvq.com/posts/384a1fa6.html"/>
    <id>https://www.kzmqvq.com/posts/384a1fa6.html</id>
    <published>2024-04-25T05:55:05.000Z</published>
    <updated>2024-04-26T01:37:42.533Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 🍭 前言</h2><p>老大安排的，被迫营业，去给同事讲 <code>Nginx</code>。别急着走嘛🫠文章中的几个例子很简单的。</p><h2 id="i️-基本介绍可跳过但强烈建议看看"><a class="markdownIt-Anchor" href="#i️-基本介绍可跳过但强烈建议看看"></a> ℹ️ 基本介绍（可跳过，但强烈建议看看）</h2><p>Nginx 是一个高性能的 HTTP 服务器和反向代理，它以其稳定性、丰富的功能集、简单的配置和低资源消耗而闻名。Nginx主要用来处理HTTP请求，提供负载均衡、静态内容服务、反向代理等功能。</p><p><strong>正向代理</strong>：居家办公用过公司的内网VPN吧，你所有的请求在发送前，被代理成了内网的IP去获取内网的资源，如数据库、私有代码仓库等。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/25/Keo9jbJ3EOXsDZ5.png" alt="" /></p><p><strong>反向代理</strong>：业务中经常用到，所有前端的请求被发送到同一个端口(80)，通过Nginx监听转发到相应的前端、后端上。比如 前端Vue项目启动在8080上，但它不会被直接访问，只会从80端口被转发到8080，用户浏览器显示的站点还是原站点，只是内容变成了8080的页面。</p><blockquote><p>🚑 热备（backup）：服务器界的“备胎”，一台服务器故障，另一台马上顶上。<br />🎭 轮询：请求按顺序分发到服务器，雨露均沾。<br />⚖️ 加权轮询（weight）：根据配置的权重大小而分发给不同服务器不同数量的请求，可根据服务器配置调整对应权重，让强壮的服务器多干点活，降低其他服务器负载。<br />🔄 ip_hash：让相同IP的客户端总是访问同一个服务器，保持会话一致性。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/25/ZFf5QisI9oBry7t.png" alt="" /></p><h2 id="参数配置"><a class="markdownIt-Anchor" href="#参数配置"></a> 🔑 参数配置</h2><p>Nginx 的主配置文件通常位于以下位置📍：</p><ul><li><strong>linux系统</strong>：<code>/etc/nginx/nginx.conf</code></li><li><strong>Windows系统</strong>：随Nginx安装路径而变化，在安装目录下的 <code>conf\nginx.conf</code> 中，如果你安装在 <code>D:/program/nginx-1.22</code>，那么配置文件就在 <code>D:/program/nginx-1.22/conf/nginx.conf</code></li></ul><p>其配置结构如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-——全局块</span><br><span class="line">|</span><br><span class="line">|——event块</span><br><span class="line">|</span><br><span class="line">-——http块</span><br><span class="line">  |</span><br><span class="line">  -——server块</span><br><span class="line">      |</span><br><span class="line">      -——location块</span><br></pre></td></tr></table></figure><p>Nginx默认配置及说明如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    root           html;</span></span><br><span class="line">        <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">        <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">        <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">        <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">        <span class="comment">#    deny  all;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># another virtual host using mix of IP-, name-, and port-based configuration</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       8000;</span></span><br><span class="line">    <span class="comment">#    listen       somename:8080;</span></span><br><span class="line">    <span class="comment">#    server_name  somename  alias  another.alias;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTPS server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       443 ssl;</span></span><br><span class="line">    <span class="comment">#    server_name  localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></span><br><span class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></span><br><span class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span><br><span class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########### 每个指令必须有分号结束。#################</span></span><br><span class="line"><span class="comment">#user administrator administrators;  #配置用户或者组，默认为nobody nobody。</span></span><br><span class="line"><span class="comment">#worker_processes 2;  #允许生成的进程数，默认为1</span></span><br><span class="line"><span class="comment">#pid /nginx/pid/nginx.pid;   #指定nginx进程运行文件存放地址</span></span><br><span class="line"><span class="attribute">error_log</span> log/<span class="literal">error</span>.log <span class="literal">debug</span>;  <span class="comment">#制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg</span></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">accept_mutex</span> <span class="literal">on</span>;   <span class="comment">#设置网路连接序列化，防止惊群现象发生，默认为on</span></span><br><span class="line">    <span class="attribute">multi_accept</span> <span class="literal">on</span>;  <span class="comment">#设置一个进程是否同时接受多个网络连接，默认为off</span></span><br><span class="line">    <span class="comment">#use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;    <span class="comment">#最大连接数，默认为512</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;   <span class="comment">#文件扩展名与文件类型映射表</span></span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream; <span class="comment">#默认文件类型，默认为text/plain</span></span><br><span class="line">    <span class="comment">#access_log off; #取消服务日志    </span></span><br><span class="line">    <span class="attribute">log_format</span> myFormat <span class="string">&#x27;<span class="variable">$remote_addr</span>–<span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] <span class="variable">$request</span> <span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> <span class="variable">$http_referer</span> <span class="variable">$http_user_agent</span> <span class="variable">$http_x_forwarded_for</span>&#x27;</span>; <span class="comment">#自定义格式</span></span><br><span class="line">    <span class="attribute">access_log</span> log/access.log myFormat;  <span class="comment">#combined为日志格式的默认值</span></span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;   <span class="comment">#允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。</span></span><br><span class="line">    <span class="attribute">sendfile_max_chunk</span> <span class="number">100k</span>;  <span class="comment">#每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span>;  <span class="comment">#连接超时时间，默认为75s，可以在http，server，location块。</span></span><br><span class="line"></span><br><span class="line">    <span class="section">upstream</span> mysvr &#123;   </span><br><span class="line">      <span class="attribute">server</span> <span class="number">127.0.0.1:7878</span>;</span><br><span class="line">      <span class="attribute">server</span> <span class="number">192.168.10.121:3333</span> backup;  <span class="comment">#热备</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> https://www.baidu.com; <span class="comment">#错误页</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">keepalive_requests</span> <span class="number">120</span>; <span class="comment">#单连接请求上限次数。</span></span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">4545</span>;   <span class="comment">#监听端口</span></span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">127.0.0.1</span>;   <span class="comment">#监听地址       </span></span><br><span class="line">        <span class="section">location</span>  ~*^.+$ &#123;       <span class="comment">#请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。</span></span><br><span class="line">           <span class="comment">#root path;  #根目录</span></span><br><span class="line">           <span class="comment">#index vv.txt;  #设置默认页</span></span><br><span class="line">           <span class="attribute">proxy_pass</span>  http://mysvr;  <span class="comment">#请求转向mysvr 定义的服务器列表</span></span><br><span class="line">           <span class="attribute">deny</span> <span class="number">127.0.0.1</span>;  <span class="comment">#拒绝的ip</span></span><br><span class="line">           <span class="attribute">allow</span> <span class="number">172.18.5.54</span>; <span class="comment">#允许的ip           </span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="案例教学"><a class="markdownIt-Anchor" href="#案例教学"></a> 🌰 案例教学</h2><h3 id="location-匹配优先级不讲后缀匹配"><a class="markdownIt-Anchor" href="#location-匹配优先级不讲后缀匹配"></a> 🔝 location 匹配优先级（不讲后缀匹配）</h3><p>1、<strong>精准匹配</strong> （优先级最高）</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将所有对根域名的请求都重定向到统一认证的地址</span></span><br><span class="line"><span class="section">location</span> = / &#123;</span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> https://iam.test.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、<strong>正则前缀匹配</strong>（匹配到后，停止搜索）</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#所有匹配到 /images/ 请求都会转发到静态资源服务器的images路径下</span></span><br><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /images/ &#123;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$proxy_host</span>;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://static_server/images;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、<strong>不区分大小写、区分大小写的前缀匹配</strong>（~* 优先级高于 ~，但仍会向下搜索）</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~* /upload</span> &#123;</span><br><span class="line">  // 不区分大小写</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> <span class="regexp">~ /Upload</span> &#123;</span><br><span class="line">  // 区分大小写 且优先级低于 ~*</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> <span class="regexp">~* /upload/images</span> &#123;</span><br><span class="line">  // 优先级相同，取规则最准确的（最长的）</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、<strong>前缀匹配</strong>（最常用）</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /api/weekly &#123;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$proxy_host</span>;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://backend_server/weekly;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5、<strong>通用匹配</strong>（任何未匹配到的请求都会走这条配置，由于与1的精准匹配重叠，所以不会生效）</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="comment"># proxy_http_version 1.1;</span></span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">client_max_body_size</span> <span class="number">20M</span>;</span><br><span class="line">  <span class="attribute">client_body_buffer_size</span> <span class="number">20M</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host test.com;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://dev_ui;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info flat"><p>优先级及匹配字符长度相同的情况下，按location块先后顺序决定优先级</p></div><h3 id="️-root路径映射"><a class="markdownIt-Anchor" href="#️-root路径映射"></a> ➡️ root路径映射</h3><p>root被用来统一查找文件时的根目录，路径映射规则简单直观。它可以在http、server、location中定义，可单独使用。路径映射的规则可以直接参照linux命令行。</p><ul><li>作用：定义全局的根目录，可被子模块中的root配置覆盖。</li><li>位置：可以在http、server、location中定义，可单独使用。</li><li>映射规则：可以相对路径、可以是绝对路径。</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通用匹配只能有一条，多条nginx -t 检查会报错</span></span><br><span class="line"><span class="comment"># 换句话说，配置中只能有一个 location / &#123;&#125; 块</span></span><br><span class="line"><span class="comment"># 下列配置仅针对 精准匹配未影响通用匹配的情况下，且只能有一份</span></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="comment"># 访问test.com显示/usr/local/html/absolute下的index.htm(l)页面</span></span><br><span class="line">  <span class="attribute">root</span> /usr/local/html/absolute;</span><br><span class="line">  <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="comment"># 访问test.com显示D:/usr/local/html/test下的index.htm(l)页面</span></span><br><span class="line">  <span class="attribute">root</span>   D:/usr/local/html/test;</span><br><span class="line">  <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="comment"># 访问test.com显示 nginx 安装目录下的 html/relative/index.htm(l) 页面</span></span><br><span class="line">  <span class="attribute">root</span>   html/relative;</span><br><span class="line">  <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/25/vMwVzagtXAClnbY.png" style="zoom:50%;" /><h3 id="root-与-alias-的区别"><a class="markdownIt-Anchor" href="#root-与-alias-的区别"></a> 🔍 root 与 alias 的区别</h3><ol><li><p>路径<br />root的处理结果：root路径＋location路径<br />alias的处理结果：使用alias路径替换location路径<br />alias是一个目录别名的定义，root则是最上层目录的定义</p></li><li><p>作用域<br />alias只能作用在location中；而root可以存在server、http和location中，且会影响其他块。</p></li><li><p>语法格式<br />alias后面必须要用 “/” 结束，不然会被认为是个文件，而找不到对应的目录；而root则对 “/” 可有可无。</p><p>alias不支持直接使用正则，但可以获取location匹配的参数，且必须使用。</p><p>在同一个 location 块中，不能同时使用 root 和 alias。</p></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/25/5EtDvQWmOjAY74J.png" alt="" /></p><div class="note primary flat"><p>建议在server块中定义全局的根目录，在location块中根据需要配置alias。如果需要正则匹配实现alias的效果，就用到了rewrite。</p></div><h3 id="️-rewrite重写"><a class="markdownIt-Anchor" href="#️-rewrite重写"></a> ↩️ rewrite重写</h3><p>rewrite 指令是 Nginx 中的瑞士军刀，它可以用来重写请求URI，实现各种灵活的跳转和路由。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> rewrite    &lt;regex&gt;    &lt;replacement&gt;    [flag];</span><br><span class="line">关键字      正则        替代内容          flag标记(可为空）</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/25/ifVh7UFJ4cPqwzC.png" alt="" /></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /testrewrite &#123;</span><br><span class="line">  <span class="comment"># 使用rewrite指令重写请求URI</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> https://baidu.com <span class="literal">permanent</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 重写后的请求将被转发到baidu.com</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> /testrewrite2/ &#123;</span><br><span class="line">    <span class="comment"># 使用rewrite指令重写请求URI</span></span><br><span class="line">    <span class="comment"># 捕获 /testrewrite2/ 后面的所有内容作为 $1</span></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/testrewrite2/(.*)$</span> https://cn.bing.com/search?q=<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">    <span class="comment"># 转发到重写后的 URI</span></span><br><span class="line">    <span class="comment">#proxy_pass https://cn.bing.com;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接"></a> 🔗 参考链接</h2><div class="tag link"><a class="link-card" title="Nginx配置详解" href="https://www.runoob.com/w3cnote/nginx-setup-intro.html"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Nginx配置详解</p><p class="url">https://www.runoob.com/w3cnote/nginx-setup-intro.html</p></div></a></div><div class="tag link"><a class="link-card" title="Nginx系列：root与alias指令用法的区别" href="https://cloud.tencent.com/developer/article/1696822"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Nginx系列：root与alias指令用法的区别</p><p class="url">https://cloud.tencent.com/developer/article/1696822</p></div></a></div><div class="tag link"><a class="link-card" title="正向代理、反向代理及负载均衡" href="https://blog.csdn.net/justinqin/article/details/119519019"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">正向代理、反向代理及负载均衡</p><p class="url">https://blog.csdn.net/justinqin/article/details/119519019</p></div></a></div><div class="tag link"><a class="link-card" title="Nginx官方文档" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#alias"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Nginx官方文档</p><p class="url">https://nginx.org/en/docs/http/ngx_http_core_module.html#alias</p></div></a></div><div class="tag link"><a class="link-card" title="Nginx做负载均衡并显示转发日志" href="https://www.cnblogs.com/woaimengmeng/p/15331167.html"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Nginx做负载均衡并显示转发日志</p><p class="url">https://www.cnblogs.com/woaimengmeng/p/15331167.html</p></div></a></div><div class="tag link"><a class="link-card" title="Nginx 反向代理与负载均衡详解" href="https://www.runoob.com/w3cnote/nginx-proxy-balancing.html"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Nginx 反向代理与负载均衡详解</p><p class="url">https://www.runoob.com/w3cnote/nginx-proxy-balancing.html</p></div></a></div><div class="tag link"><a class="link-card" title="Nginx location匹配规则及优先级" href="https://blog.csdn.net/why_still_confused/article/details/109953803"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Nginx location匹配规则及优先级</p><p class="url">https://blog.csdn.net/why_still_confused/article/details/109953803</p></div></a></div>]]></content>
    
    
    <summary type="html">我一个开发，你让我去讲Nginx????</summary>
    
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/categories/Web/"/>
    
    <category term="运维" scheme="https://www.kzmqvq.com/categories/Web/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="随手记" scheme="https://www.kzmqvq.com/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
    <category term="运维" scheme="https://www.kzmqvq.com/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="Nginx" scheme="https://www.kzmqvq.com/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>【百宝箱】🌟 太极工具箱：你的摸鱼新选择 🌟</title>
    <link href="https://www.kzmqvq.com/posts/708ef8fe.html"/>
    <id>https://www.kzmqvq.com/posts/708ef8fe.html</id>
    <published>2024-04-22T02:05:57.000Z</published>
    <updated>2024-04-25T05:53:28.829Z</updated>
    
    <content type="html"><![CDATA[<p>这是一款聚合了各类资源功能的神奇工具🎉，由吾爱论坛的大佬@buyaobushuo精心打造，现已在GitHub上开源。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/22/oU2gYWIuwxKhrqV.png" alt="" /></p><h2 id="️-观山"><a class="markdownIt-Anchor" href="#️-观山"></a> 🖼️ 观山</h2><p>“观山”功能是一个壁纸资源的聚合平台，它汇聚了各式各样的壁纸，满足不同用户的个性化需求。无论你是自然风光的爱好者、动漫角色的粉丝，还是时尚摄影的追随者，这里都能提供令你满意的壁纸选择。</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/22/hi6vCXuKy8wfTsP.png" style="zoom:50%;" /><p>它支持回看、下载、设为背景、保存至本地同时设为背景、清除背景的功能，为壁纸爱好者提供了极大的便利，是追求个性化桌面体验用户的福音。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/22/JOK46fZIVnEBbRy.png" alt="" /></p><h2 id="听雨"><a class="markdownIt-Anchor" href="#听雨"></a> 🎵 <strong>听雨</strong></h2><p>“听雨”是一个聚合了多个音源的音乐平台，无论是最新流行还是经典老歌，都能轻松找到。</p><p>音源定期更新，而且，所有音乐都可以无限制地下载到你的设备上，让你即使离线也能享受音乐。</p><p>此外，你还可以根据自己的喜好创建和编辑个性化歌单，完全掌控你的音乐之旅。</p><p>唯一缺点可能就是不支持外部歌单导入，不能像 <code>Listen 1</code> 一样导入其他平台的歌单。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/22/qHWQfc8wU2mdKYM.png" alt="" /></p><h2 id="修仙"><a class="markdownIt-Anchor" href="#修仙"></a> 📚 修仙</h2><p>🤚🖐️“一颗金丹吞入腹，我命由我不由天！” “受命于天，既寿永昌！”</p><p>什么乱七八糟的事情都可以放放，唯有仙道不行。</p><p>“修仙”模块为你提供了一个逃离现实，沉浸于修仙小说世界的窗口。在这里，你可以探索各种修仙故事，体验一段段奇妙的修真之旅。（所以我用笔趣阁🐶）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/22/1HRBFXQCVfu8hDk.png" alt="" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/22/SJl5KXtH6kvVOn7.png" alt="" /></p><h2 id="抚琴"><a class="markdownIt-Anchor" href="#抚琴"></a> 🎹 抚琴</h2><p>各种网盘里得到资源，都能在这找到🎉，Python、Java教程、口腔医学、电子书籍等等，只有你想不到的🤣</p><h2 id="小站览竹"><a class="markdownIt-Anchor" href="#小站览竹"></a> 🎍小站&amp;览竹</h2><p>全网的电影蓝光版（大概）、动漫之家的漫画，应有尽有。走过路过不要错过🤪</p><h2 id="百宝箱-藏经阁"><a class="markdownIt-Anchor" href="#百宝箱-藏经阁"></a> 📦 百宝箱 &amp; 藏经阁</h2><p>这两个功能集合了多种实用工具，部分需要vip，但网上都可以找到平替，如一点红文本转语音、bigimg（一键放大图片）、office tools（一键pdf转word）、腾讯的帮小忙（超级好用🎉）等等。</p><h2 id="下载地址"><a class="markdownIt-Anchor" href="#下载地址"></a> 🔗 <strong>下载地址</strong></h2><ul><li>太极工具箱：<a href="https://wwd.lanzout.com/iu63v1tnwwtc">点击下载</a></li><li>开源地址：<a href="https://github.com/cuifengcn/TAICHI-flet">GitHub</a></li></ul>]]></content>
    
    
    <summary type="html">观山听雨，抚琴修仙，人生乐事，大善！</summary>
    
    
    
    <category term="实用工具" scheme="https://www.kzmqvq.com/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="Tools" scheme="https://www.kzmqvq.com/tags/Tools/"/>
    
  </entry>
  
  <entry>
    <title>【百宝箱】🌟 Kimi 智能助手 —— 智慧生活，触手可及 🌟</title>
    <link href="https://www.kzmqvq.com/posts/70dfecc2.html"/>
    <id>https://www.kzmqvq.com/posts/70dfecc2.html</id>
    <published>2024-04-17T02:09:27.000Z</published>
    <updated>2024-04-17T02:51:56.257Z</updated>
    
    <content type="html"><![CDATA[<h1 id="kimi-智能助手-智慧生活触手可及"><a class="markdownIt-Anchor" href="#kimi-智能助手-智慧生活触手可及"></a> <strong>🌟 Kimi 智能助手 —— 智慧生活，触手可及 🌟</strong></h1><h2 id="引言"><a class="markdownIt-Anchor" href="#引言"></a> 🚀 引言</h2><p>探索未知，拓宽视野，Kimi 智能助手与您同行。由月之暗面科技有限公司精心打造的这款智能问答和文档阅读助手，旨在为您提供高效、便捷的信息获取和问题解决服务。接下来，让我们一起了解Kimi的核心功能和应用场景，以及丰富的提示词模板。</p><hr /><h2 id="功能亮点"><a class="markdownIt-Anchor" href="#功能亮点"></a> 📚 功能亮点</h2><h3 id="智能问答"><a class="markdownIt-Anchor" href="#智能问答"></a> 🤖 智能问答</h3><ul><li>面对千奇百怪的问题，Kimi 都能以智能的方式给出解答。</li><li>无需魔法，在国内即可拥有流畅的对话体验，让获取知识变得轻松愉快。</li></ul><h3 id="文档阅读"><a class="markdownIt-Anchor" href="#文档阅读"></a> 📄 文档阅读</h3><ul><li>支持多种文件格式，包括 TXT、PDF、Word、PPT 和 Excel。</li><li>提供信息摘要，助力您快速把握文档要点。</li><li>问答式获取文档细节，告别眼花缭乱、头昏脑胀。</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/17/pBJU8Z5NlAoaWDu.png" alt="" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/17/fT4HQwaUFcdo5Ax.png" alt="" /></p><h3 id="互联网搜索"><a class="markdownIt-Anchor" href="#互联网搜索"></a> 🌐 互联网搜索</h3><ul><li>结合最新网络信息，为您提供全面的答案。</li><li>通过链接和关键词，让搜索结果更加精准。</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/17/eSOMbDz48L2BpYk.png" alt="" /></p><h3 id="多语言对话"><a class="markdownIt-Anchor" href="#多语言对话"></a> 🌍 多语言对话</h3><ul><li>无论是中文还是英文，Kimi 都能提供流畅的对话体验。</li></ul><h3 id="丰富的提示词模板"><a class="markdownIt-Anchor" href="#丰富的提示词模板"></a> 📜 丰富的提示词模板</h3><ul><li>Kimi 目前提供十五种提示词模板，包括小红书标题、美文排版、推闻快写、长文本总结等，帮助用户快速构建问题，提升交互效率。</li><li>支持用户自定义模板，你可以打造更加垂直、适合自己的贴心小助手。</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/17/byeiMHLscZF3G1q.png" alt="" /></p><hr /><h2 id="使用场景"><a class="markdownIt-Anchor" href="#使用场景"></a> 🎯 使用场景</h2><h3 id="学术研究"><a class="markdownIt-Anchor" href="#学术研究"></a> 📚 学术研究</h3><ul><li>助您深入挖掘学术资料，实现快速文件检索。通过互联网搜索功能，帮助研究人员快速找到所需的学术论文和文献。</li><li>解读复杂论文。Kimi能够阅读和理解上传的论文内容，并提供全文摘要，帮助用户快速把握文献的核心内容。</li><li>专业术语解释。在研究生物学论文时，用户遇到不熟悉的生物学术语，提供清晰的定义和解释，帮助用户理解。</li></ul><h3 id="商业分析"><a class="markdownIt-Anchor" href="#商业分析"></a> 💼 商业分析</h3><ul><li>数据分析支持，提供统计学和数据解读的帮助。可以协助用户进行数据整理和分析，提供统计结果的解读。</li><li>趋势跟踪。可以监测和分析金融领域的最新趋势和动态，定期提供该领域的最新报道和全球动态，帮助用户打破信息差。</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/17/jX9hNHrob8UCBek.png" alt="" /></p><h3 id="️-日常咨询"><a class="markdownIt-Anchor" href="#️-日常咨询"></a> 🏙️ 日常咨询</h3><ul><li>轻松解答日常生活中的各种疑问，提供出行、聚餐、穿衣建议。</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/17/W5fcVotrYSAwJuM.png" alt="" /></p><h3 id="️-技术支持"><a class="markdownIt-Anchor" href="#️-技术支持"></a> 🛠️ 技术支持</h3><ul><li>提供编程指导，助力技术难题解决。</li><li>支持各类函数查询，和记忆公式说拜拜。</li></ul><hr /><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 🎉 总结</h2><p>🚀 <strong>提升效率</strong>：遇见Kimi，让工作效率飞跃。</p><p>🧠 <strong>智能问答</strong>：Kimi在手，疑问不再有。</p><p>📚 <strong>文档解读</strong>：轻松掌握核心要点，让知识触手可及。</p><p>🌐 <strong>信息搜索</strong>：快速获取最新资讯，站在知识前沿。</p><p>🌍 <strong>语言无障碍</strong>：无论中英文，Kimi都能流畅对话。</p><p>📜 <strong>提示词模板</strong>：构建问题更简单，获取答案更快捷。</p><hr /><h2 id="开始体验"><a class="markdownIt-Anchor" href="#开始体验"></a> 📱 开始体验</h2><h3 id="️-下载kimi-app"><a class="markdownIt-Anchor" href="#️-下载kimi-app"></a> 🏷️ 下载Kimi App</h3><ul><li>立即体验智能问答和文档阅读的魅力。<ul><li>地址：<a href="https://kimi.moonshot.cn/download/app?ref=chat">点击下载</a></li></ul></li></ul><h3 id="️-访问官网"><a class="markdownIt-Anchor" href="#️-访问官网"></a> 🖥️ 访问官网</h3><ul><li>在电脑上享受Kimi带来的便捷服务。<ul><li>网址：<a href="https://kimi.ai">访问官网</a></li></ul></li></ul><p>🌈 让Kimi成为您的智能伙伴，一起开启高效、便捷的工作生活！</p>]]></content>
    
    
    <summary type="html">Kimi！彻底告别 GPT3.5 啦！！！</summary>
    
    
    
    <category term="实用工具" scheme="https://www.kzmqvq.com/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="Tools" scheme="https://www.kzmqvq.com/tags/Tools/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】pyenv的安装及使用</title>
    <link href="https://www.kzmqvq.com/posts/6a7b3be7.html"/>
    <id>https://www.kzmqvq.com/posts/6a7b3be7.html</id>
    <published>2024-04-08T01:28:32.000Z</published>
    <updated>2024-04-09T02:55:46.049Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a class="markdownIt-Anchor" href="#问题描述"></a> 问题描述</h2><p>上周，我遇到了一个有趣的开源项目，想要在本地尝试运行。该项目兼容的 <code>python</code> 版本为 3.7 - 3.9，好嘛🤣哥们本地只装了3.6。因此，我需要一个版本管理工具来切换不同版本的 <code>python</code>。</p><p>由于我的新电脑还没有安装 <code>conda</code>，并且目前的工作不涉及复杂的依赖关系或科学计算、机器学习任务，我选择了轻量级的 <code>pyenv</code>。</p><h2 id="安装步骤"><a class="markdownIt-Anchor" href="#安装步骤"></a> 安装步骤</h2><ul><li>🌐 <strong>适用于 windows 版本的 pyenv-win 安装步骤：</strong></li></ul><ol><li><p>🛠️ 以管理员身份打开终端，执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest -UseBasicParsing -Uri <span class="string">&quot;https://raw.githubusercontent.com/pyenv-win/pyenv-win/master/pyenv-win/install-pyenv-win.ps1&quot;</span>  -OutFile <span class="string">&quot;./install-pyenv-win.ps1&quot;</span>; &amp;<span class="string">&quot;./install-pyenv-win.ps1&quot;</span></span><br></pre></td></tr></table></figure><p>安装过程可能较慢，请耐心等待。</p></li><li><p>🔄 重启终端。</p></li><li><p>🏗️ 运行 <code>pyenv --version</code> 验证 <code>pyenv</code> 是否安装成功。</p></li><li><p>📊 查看当前可安装的 <code>python</code> 版本 <code>pyenv install -l</code>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/08/rcbShmO1685nUKX.png" alt="图片描述" /></p></li><li><p>🚀 毫不犹豫地安装 <code>3.8.0</code> 版本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv install 3.8.0</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/08/ai4zvlkWZ2sF8CL.png" alt="图片描述" /></p></li><li><p>🌍 设置本地环境使用的 <code>python</code> 版本，<code>pyenv global 3.8.0</code>，如需更改版本，只需将 3.8.0 替换为相应的版本号。</p></li><li><p>🔍 检查当前 <code>python</code> 版本及其路径，<code>pyenv version</code>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/08/iwrJpNHX7exQvcs.png" alt="图片描述" /></p></li></ol><h2 id="使用过程"><a class="markdownIt-Anchor" href="#使用过程"></a> 使用过程</h2><ol><li><p>📂 克隆我感兴趣的项目至本地，并设置当前文件夹的环境为 <code>pyenv local 3.8.0</code>。</p></li><li><p>📦 安装对应的 <code>requirements.txt</code> 中的三方库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple  -r requirements.txt</span><br></pre></td></tr></table></figure><p>如果在安装 <code>opencv-python</code> 时出现卡在 PEP-517 的情况，升级 <code>pip</code> 版本即可解决。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --upgrade pip setuptools wheel</span><br></pre></td></tr></table></figure></li><li><p>🚀 启动 <code>py</code> 脚本，<code>python main.py</code>。</p></li></ol><h2 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接"></a> 参考链接</h2><div class="tag link"><a class="link-card" title="pyenv-win" href="https://github.com/pyenv-win/pyenv-win?tab=readme-ov-file"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">pyenv-win</p><p class="url">https://github.com/pyenv-win/pyenv-win?tab=readme-ov-file</p></div></a></div><div class="tag link"><a class="link-card" title="opencv-python安装卡住PEP 517" href="https://blog.csdn.net/ilovejohnny/article/details/121031935"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">opencv-python安装卡住PEP 517</p><p class="url">https://blog.csdn.net/ilovejohnny/article/details/121031935</p></div></a></div>]]></content>
    
    
    <summary type="html">解决使用不同python版本运行项目的问题。</summary>
    
    
    
    <category term="Python" scheme="https://www.kzmqvq.com/categories/Python/"/>
    
    
    <category term="Python" scheme="https://www.kzmqvq.com/tags/Python/"/>
    
    <category term="pyenv" scheme="https://www.kzmqvq.com/tags/pyenv/"/>
    
    <category term="版本管理" scheme="https://www.kzmqvq.com/tags/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】记录一次测试环境短信服务签名出错</title>
    <link href="https://www.kzmqvq.com/posts/d8031d5c.html"/>
    <id>https://www.kzmqvq.com/posts/d8031d5c.html</id>
    <published>2024-04-03T00:51:02.000Z</published>
    <updated>2024-04-09T03:19:00.806Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近，我们公司的一个项目在完成本地开发并部署到测试环境后，遇到了一个棘手的问题：收发短信业务签名出现了不一致的情况。具体来说，客户身份对应的应该是父公司的签名，但收到的短信签名却是子公司的。经过一番排查，最终发现的原因却让人哭笑不得……</p><h2 id="解决过程"><a class="markdownIt-Anchor" href="#解决过程"></a> 解决过程</h2><p>1、🔍 检查腾讯云短信功能</p><p>首先，我检查了腾讯云短信功能的签名和模版是否有效。结果显示，签名和模版状态都正常。</p><p>2、💻 本地调试</p><blockquote><p>免责声明：代码不是俺写的，俺就是个救火的。</p></blockquote><p>将项目克隆到本地进行测试，简单看了下函数逻辑，根据数据库中获取的客户信息，确认对应发送的短信类型 <code>sendType</code>，再根据字典表确认 <code>sendType</code> 对应的场景值 <code>sceneId</code>，每一个场景值对应着腾讯云短信服务的短信模版，这决定了短信签名和内容。</p><p>打断点，本地环境下各项参数都没问题，收到的短信也正常，先重新打包扔到测试环境看看。</p><p>不出意外地出了意外，短信依然签名出错。</p><p>3、📋 排查业务所在平台的短信发送记录</p><p>翻开对应的历史记录，顿觉大事不妙，为啥哥们本地的历史记录和测试环境不同啊，不都是从数据库里抓的吗？</p><p>等等，数据库！点开 <code>git commit</code>，找到写这个功能的同事，薅来了测试数据库的账号密码，<code>navicat</code> 打开记录场景值的数据表一看，签名类型和场景值都没问题啊？总不能是判断没执行吧。</p><p>在代码的发送类型判断并赋值场景值埋了日志，如果进行赋值操作就打印，同时打印赋值前后的 <code>sendType</code> 和 <code>sceneId</code>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/03/iaYCTkxOwAP4jUh.png" alt="" /></p><p>部署后往 <code>rancher</code> 里一蹲，md，一蹲一个不吱声( ‵o′)</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/03/FrKUN1zQLBXRknW.png" alt="" /></p><p>测试环境下压根就没走判断 <code>sendType</code> 后对场景值赋值的语句，万能的群友提问，为什么日志中 <code>sendType</code>值在第二行才打印，模版id的日志却在同一行？</p><p>特殊符号……</p><p>4、🔎 排查数据库</p><p>打开 navicat 查看具体单元格的文本内容，显示如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/03/pZ4GelWovJNIQsR.png" alt="" /></p><p>一切很明显了，<code>SEND_TYPE</code> 类型为 <code>String</code> ，可视化工具显示单元格内容的最后一行，实际值为 ‘\n311696’。</p><p>哪个开发，测试环境改数据加回车的……</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/03/rLK61TbWpiDOtNX.jpg" style="zoom:50%;" />]]></content>
    
    
    <summary type="html">记录一次测试环境部署后，发送短信服务签名出错的问题及排查过程。</summary>
    
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/categories/Web/"/>
    
    <category term="运维" scheme="https://www.kzmqvq.com/categories/Web/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="随手记" scheme="https://www.kzmqvq.com/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
    <category term="腾讯云短信" scheme="https://www.kzmqvq.com/tags/%E8%85%BE%E8%AE%AF%E4%BA%91%E7%9F%AD%E4%BF%A1/"/>
    
    <category term="Java" scheme="https://www.kzmqvq.com/tags/Java/"/>
    
    <category term="数据库" scheme="https://www.kzmqvq.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】前端多模块项目内存溢出</title>
    <link href="https://www.kzmqvq.com/posts/d856c1f0.html"/>
    <id>https://www.kzmqvq.com/posts/d856c1f0.html</id>
    <published>2024-03-28T07:54:52.000Z</published>
    <updated>2024-04-09T03:28:36.779Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近起公司的前端项目又爆内存了，忘记之前是怎么配置的，这篇博客用于备忘。</p><h2 id="问题描述"><a class="markdownIt-Anchor" href="#问题描述"></a> 问题描述</h2><p>一个很臃肿的前端多模块项目，对应后端的多个 <code>springboot</code> 模块项目，前端每次启动都会对所有的包进行打包，影响启动速度，内存也很容易爆掉。</p><p>报错如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(node:28820) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 upgrade listeners added to [Server]. Use emitter.setMaxListeners() to increase <span class="built_in">limit</span></span><br><span class="line">(Use `node --trace-warnings ...` to show <span class="built_in">where</span> the warning was created)</span><br><span class="line"></span><br><span class="line">FATAL ERROR: Reached heap <span class="built_in">limit</span> Allocation failed - JavaScript heap out of memory</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/04/09/hOaQz7Ee3XKyRu4.png" alt="" /></p><h2 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案"></a> 解决方案</h2><p>1、使用 <code>npm</code> 安装插件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g increase-memory-limit</span><br></pre></td></tr></table></figure><p>2、项目启动前，在终端运行对应命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">increase-memory-limit</span><br><span class="line"><span class="comment"># 或者下面这句</span></span><br><span class="line">increase-memory-limit.cmd</span><br></pre></td></tr></table></figure><p>3、在项目的 <code>vue.config.js</code> 中注释掉对应的内存限制行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CPU 数量&quot;</span>, <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).<span class="title function_">cpus</span>().<span class="property">length</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">require</span>(<span class="string">&#x27;v8&#x27;</span>).<span class="title function_">getHeapStatistics</span>())</span><br><span class="line"><span class="comment">// args[0].memoryLimit = 4096; 这行限制注释掉</span></span><br></pre></td></tr></table></figure><p>4、根据统一认证登录和单点登录的需要，修改 <code>loginType</code></p><p>5、运行项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h2 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接"></a> 参考链接</h2><div class="tag link"><a class="link-card" title="JavaScript heap out of memory" href="https://blog.csdn.net/xiaoran_1997/article/details/125944699"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">JavaScript heap out of memory</p><p class="url">https://blog.csdn.net/xiaoran_1997/article/details/125944699</p></div></a></div>]]></content>
    
    
    <summary type="html">前端多模块项目内存溢出的解决方案，用于解决node内存爆掉的问题。</summary>
    
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/categories/Web/"/>
    
    <category term="Vue" scheme="https://www.kzmqvq.com/categories/Web/Vue/"/>
    
    
    <category term="Vue" scheme="https://www.kzmqvq.com/tags/Vue/"/>
    
    <category term="前端" scheme="https://www.kzmqvq.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="node" scheme="https://www.kzmqvq.com/tags/node/"/>
    
    <category term="内存溢出" scheme="https://www.kzmqvq.com/tags/%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA/"/>
    
    <category term="多模块" scheme="https://www.kzmqvq.com/tags/%E5%A4%9A%E6%A8%A1%E5%9D%97/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】GitLab-CI？拿来吧你！</title>
    <link href="https://www.kzmqvq.com/posts/bf5c52e7.html"/>
    <id>https://www.kzmqvq.com/posts/bf5c52e7.html</id>
    <published>2024-03-27T01:07:35.000Z</published>
    <updated>2024-04-25T05:57:09.700Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>书接【Bug周刊】的<code>gitlab-ci</code>构建部分，我们已经对一个 <code>maven</code> 项目进行了CI构建，实现每次提交代码后自动打包为 <code>jar</code> 包，并在<code>docker in docker</code> 的镜像中 <code>build</code> 为 docker 镜像。<strong>避免跳转麻烦，把上文的构建内容放到了基础部分</strong>。</p><h2 id="基础可跳过"><a class="markdownIt-Anchor" href="#基础可跳过"></a> 基础(可跳过)</h2><h3 id="问题描述"><a class="markdownIt-Anchor" href="#问题描述"></a> 问题描述</h3><p>需要对一个<code>maven</code>项目进行自动化构建，要求每次提交都会触发构建，减少运维的工作量，将构建好的jar包打包成docker镜像并推送至私有的镜像仓库。</p><p>详情如下：</p><p>1、自定义开发的<code>common</code>模块并不完善，也没有上传至私有的<code>nexus</code>仓库，需要打包的功能模块依赖于<code>common</code></p><p>2、项目依赖的部分<code>jar</code>包需要从私有的<code>nexus</code>仓库下载，需要配置对应的仓库地址</p><p>3、构建时间的优化、提升</p><h3 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案"></a> 解决方案</h3><p>1、在代码仓库中增加 <code>.m2/settings.xml</code> 文件，配置对应的私有nexus仓库地址、阿里云或者腾讯云的nexus地址提升下载速度</p><p>2、增加 <code>localReposity</code> 配置，告诉maven在找不到对应<code>jar</code> 包时，从本地读取，完成<code>common</code>模块的引入。由于common模块是独立开发的，故和其他模块的pom父类并不一致，各个模块也有不同的配置，在原项目根目录下并没有pom文件，所以不能通过构建根pom文件的方式完成项目的打包。</p><p>3、引入cache</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">RELEASE_TAG:</span> <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">  <span class="attr">MAVEN_CLI_OPTS:</span> <span class="string">&quot;../.m2/settings.xml --batch-mode -Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">$&#123;CI_COMMIT_REF_SLUG&#125;</span> <span class="comment"># cache键值对 减少mvn下载jar包的时间 key指向当前项目分支</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">~/.m2/repository/</span> <span class="comment"># 缓存地址 镜像根目录下的 .m2/repository/ 文件夹</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">target/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CI构建两步</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">package</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">release</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在maven镜像中构建jar包</span></span><br><span class="line"><span class="attr">package:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">maven:3.6.1-jdk-8-alpine</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">package</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span> <span class="comment"># 触发构建的分支</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cd</span> <span class="string">test-common</span> <span class="comment"># 进入common模块打包</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">-s</span> <span class="string">$MAVEN_CLI_OPTS</span> <span class="string">-e</span> <span class="string">package</span> <span class="string">install</span> <span class="comment"># 打包 并将打包后生成的jar下载至 镜像根目录.m2/repository/路径下(本地仓库)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cd</span> <span class="string">../test-app</span> <span class="comment"># 切出common 打包其他模块</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">-s</span> <span class="string">$MAVEN_CLI_OPTS</span> <span class="string">-e</span> <span class="string">package</span></span><br><span class="line">  <span class="attr">artifacts:</span> <span class="comment"># 构建好的jar文件上传 并设置过期时间</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test-app/target/test-app-application-exec.jar</span></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">1</span> <span class="string">hours</span></span><br><span class="line"></span><br><span class="line"><span class="attr">release:</span> <span class="comment"># docker in docker 在docker中构建jar为docker镜像</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:20-dind</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">release</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker-slim</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">--username=username</span> <span class="string">-p</span> <span class="string">$REPOS_PASSWORD</span> <span class="string">test.com</span> <span class="comment"># 配置私有镜像仓库的账号 密码 地址</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">df</span> <span class="string">-h</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">-t</span> <span class="string">test/test-app:$RELEASE_TAG</span> <span class="string">.</span> <span class="comment"># docker镜像标签</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">test.com/test-image/test-app:$RELEASE_TAG</span> <span class="comment"># 推送</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="进阶"><a class="markdownIt-Anchor" href="#进阶"></a> 进阶</h2><h3 id="问题描述-2"><a class="markdownIt-Anchor" href="#问题描述-2"></a> 问题描述</h3><p>目前的业务需求是，在原maven项目的基础上，根目录增加了同级的模块，需要分模块构建，并且<strong>每次提交代码只对产生变更的模块进行打包</strong>。</p><p>文件夹树如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|---.m2</span><br><span class="line">|---gateway</span><br><span class="line">|---moudle</span><br><span class="line">  |---hr</span><br><span class="line">  |---manage</span><br><span class="line">  |---adminstrive</span><br><span class="line">|---.gitlab-ci.yml</span><br><span class="line">|---dockerfile</span><br><span class="line">|---startup.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="解决方案-2"><a class="markdownIt-Anchor" href="#解决方案-2"></a> 解决方案</h3><p>1、对变更模块进行判断，需要使用 <code>git diff</code> 命令</p><div class="note info flat"><p><strong>单纯的maven3.6版本的镜像没有git</strong>，同时也未安装对应的命令行工具，如apt、apk、yum等，因此无法在 <code>before_script</code> 阶段安装 <code>git</code> 工具曲线救国。只能更换原来的镜像。</p></div><p>2、分模块构建，需要使用通用的 <code>dockerfile</code> ，即在<code>gitlab-ci.yml</code>中对构建模块名进行判断，将此作为变量传入到dockerfile中。</p><div class="note info flat"><p>docker build 命令提供了 <code>--build-arg</code> 的参数可以将变量传入dockerfile中。</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/27/bvhBgEAmdkiuxFM.png" alt="" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/27/Oom67vXr5zEwRHq.png" alt="" /></p><p>3、明确CI文件 <code>script</code> 中的命令与 <code>linux</code> 终端命令细微的区别，避免出现标点的错误。</p><div class="note warning flat"><p>少年要不要来回试试，没有这些<code>; \ \n &amp;&amp;</code>符号，可能会寸步难行。</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/27/ePLlvI2Z4tCfsSX.png" alt="" /></p><p>4、选择正确的镜像，满足打包和构建的使用要求。</p><div class="note info flat"><p>如果在 <code>dind</code> 镜像中没有git命令对模块判断进行 <code>build</code>，不妨试试判断上一步，对产生变更的模块进行打包，是否有产物传给这一步骤，判断文件是否存在，比再安装一遍git省事多了。</p></div><p>5、纠正基础中的缓存地址。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/27/LSy9tvdT8Xes4g6.png" alt="" /></p><h3 id="配置文件"><a class="markdownIt-Anchor" href="#配置文件"></a> 配置文件</h3><p><strong>.gitlab-ci.yml</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="comment"># 将打包文件的路径作为变量 简化后续代码长度</span></span><br><span class="line">  <span class="attr">RELEASE_TAG:</span> <span class="string">&quot;0.0.1&quot;</span></span><br><span class="line">  <span class="attr">JAR_HR:</span> <span class="string">&quot;module/module-hr/target/module-hr-exec.jar&quot;</span></span><br><span class="line">  <span class="attr">JAR_MANAGE:</span> <span class="string">&quot;module/module-manage/target/module-manage-exec.jar&quot;</span></span><br><span class="line">  <span class="comment"># .m2文件夹在代码的根目录 模块在 下两层 比如 moudle/hr moudle/manage 所以需要跳出两次</span></span><br><span class="line">  <span class="attr">MAVEN_CLI_OPTS:</span> <span class="string">&quot;../../.m2/settings.xml --batch-mode -Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#cache:</span></span><br><span class="line"><span class="comment">#  key: $&#123;CI_COMMIT_REF_SLUG&#125;</span></span><br><span class="line"><span class="comment">#  paths:</span></span><br><span class="line"><span class="comment">#    这是第一次的缓存配置 路径错误 因为已经指明了maven 安装jar包的地址 </span></span><br><span class="line"><span class="comment">#    为 maven.repo.local=$CI_PROJECT_DIR/.m2/repository</span></span><br><span class="line"><span class="comment">#    - ~/.m2/repository/</span></span><br><span class="line"><span class="comment">#    - target/</span></span><br><span class="line"><span class="comment">#    - /usr/share/maven</span></span><br><span class="line"><span class="comment">#    - /root/.m2/repository</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">m2-repo</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="comment"># 这两个地址是等效的 都指向服务器的 /builds/username/projectName/.m2/repository</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">.m2/repository/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$CI_PROJECT_DIR/.m2/repository</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">package</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">release</span></span><br><span class="line"></span><br><span class="line"><span class="attr">package:</span></span><br><span class="line">  <span class="comment"># 单纯maven不行 我用java带maven很合理吧 java镜像有apt-get 这很河狸吧</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">labelinsight/java-maven:3.6-jdk-8</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">package</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">-y</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="comment"># git diff 命令判断模块是否发生变更 并判断是否发生在对应的 hr manage 模块下</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">if</span> [[ <span class="string">-n</span> <span class="string">$(git</span> <span class="string">diff</span> <span class="string">--name-only</span> <span class="string">$CI_COMMIT_BEFORE_SHA</span> <span class="string">$CI_COMMIT_SHA</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">&#x27;^module/module-hr/&#x27;</span><span class="string">)</span> ]]<span class="string">;</span> <span class="string">then</span></span><br><span class="line">        <span class="string">cd</span> <span class="string">module/module-hr;</span></span><br><span class="line">        <span class="string">mvn</span> <span class="string">-s</span> <span class="string">$MAVEN_CLI_OPTS</span> <span class="string">-e</span> <span class="string">package;</span></span><br><span class="line">        <span class="string">cd</span> <span class="string">../../;</span></span><br><span class="line">      <span class="string">fi;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">if</span> [[ <span class="string">-n</span> <span class="string">$(git</span> <span class="string">diff</span> <span class="string">--name-only</span> <span class="string">$CI_COMMIT_BEFORE_SHA</span> <span class="string">$CI_COMMIT_SHA</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">&#x27;^module/module-manage/&#x27;</span><span class="string">)</span> ]]<span class="string">;</span> <span class="string">then</span></span><br><span class="line">        <span class="string">cd</span> <span class="string">module/module-manage;</span></span><br><span class="line">        <span class="string">mvn</span> <span class="string">-s</span> <span class="string">$MAVEN_CLI_OPTS</span> <span class="string">-e</span> <span class="string">package;</span></span><br><span class="line">        <span class="string">cd</span> <span class="string">../../;</span></span><br><span class="line">      <span class="string">fi;</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">module/module-hr/target/module-hr-exec.jar</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">module/module-manage/target/module-manage-exec.jar</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">1</span> <span class="string">hours</span></span><br><span class="line"></span><br><span class="line"><span class="attr">release:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:20-dind</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">release</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker-slim</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="comment"># - apk add git 判断文件是否存在 不用装git了</span></span><br><span class="line">    <span class="comment"># $REPOS_PASSWORD 为管理员提前设置好的系统变量</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">--username=username</span> <span class="string">-p</span> <span class="string">$REPOS_PASSWORD</span> <span class="string">docker.repos.cscec81.com:4433</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">df</span> <span class="string">-h</span></span><br><span class="line">    <span class="comment"># 打标签 --build-arg 传变量 变量名为 BUILD_JAR_NAME  对应值是开始在 variables部分 设定好的</span></span><br><span class="line">    <span class="comment"># 推送至 私有的docker镜像仓库</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">if</span> [[ <span class="string">-f</span> <span class="string">&quot;module/module-hr/target/module-hr-exec.jar&quot;</span> ]]<span class="string">;</span> <span class="string">then</span></span><br><span class="line">        <span class="string">docker</span> <span class="string">build</span> <span class="string">-t</span> <span class="string">test/test-hr:$RELEASE_TAG</span> <span class="string">--build-arg</span> <span class="string">BUILD_JAR_NAME=$JAR_HR</span> <span class="string">.;</span></span><br><span class="line">        <span class="string">docker</span> <span class="string">push</span> <span class="string">repos.test.com/test-image/test-hr:$RELEASE_TAG;</span></span><br><span class="line">      <span class="string">fi;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">if</span> [[ <span class="string">-f</span> <span class="string">&quot;module/module-manage/target/module-manage-exec.jar&quot;</span> ]]<span class="string">;</span> <span class="string">then</span></span><br><span class="line">        <span class="string">docker</span> <span class="string">build</span> <span class="string">-t</span> <span class="string">test/test-manage:$RELEASE_TAG</span> <span class="string">--build-arg</span> <span class="string">BUILD_JAR_NAME=$JAR_MANAGE</span> <span class="string">.;</span></span><br><span class="line">        <span class="string">docker</span> <span class="string">push</span> <span class="string">repos.test.com/test-image/test-manage:$RELEASE_TAG;</span></span><br><span class="line">      <span class="string">fi;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果有更多模块 按照 加变量 -&gt; 加git diff -&gt; 加产物 -&gt; 加判断推送 的流程，ctrl c v 就行了</span></span><br></pre></td></tr></table></figure><p><strong>dockerfile</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#FROM openjdk:8-jre</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker build 时传入的变量</span></span><br><span class="line"><span class="keyword">ARG</span> BUILD_JAR_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置JVM参数</span></span><br><span class="line"><span class="keyword">ENV</span> BASE_DIR=<span class="string">&quot;/app&quot;</span> \</span><br><span class="line">    JAVA_HOME=<span class="string">&quot;/usr/local/openjdk-8/&quot;</span> \</span><br><span class="line">    JAVA=<span class="string">&quot;/usr/local/openjdk-8/bin/java&quot;</span> \</span><br><span class="line">    JVM_XMS=<span class="string">&quot;8g&quot;</span> \</span><br><span class="line">    JVM_XMX=<span class="string">&quot;8g&quot;</span> \</span><br><span class="line">    JVM_XMN=<span class="string">&quot;3g&quot;</span> \</span><br><span class="line">    JVM_MS=<span class="string">&quot;128m&quot;</span> \</span><br><span class="line">    JVM_MMS=<span class="string">&quot;320m&quot;</span> \</span><br><span class="line">    TZ=<span class="string">&quot;Asia/Shanghai&quot;</span> \</span><br><span class="line">    BUILD_JAR_NAME=$BUILD_JAR_NAME</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$BASE_DIR</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试环境配置 部署时注释掉 从rancher配置</span></span><br><span class="line"><span class="comment"># 如果使用 请换成你自己的ip 和 密码</span></span><br><span class="line"><span class="keyword">ENV</span> MYSQL_HOST=<span class="number">127.0</span>.<span class="number">0.1</span> \</span><br><span class="line">    MYSQL_PORT=<span class="number">3306</span> \</span><br><span class="line">    MYSQL_SERVICE_DB_NAME=root \</span><br><span class="line">    MYSQL_SERVICE_PASSWORD=<span class="number">123456</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 时区配置 打印该模块路径 及 文件名</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">rm</span> -f /etc/localtime \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; <span class="built_in">ln</span> -sv /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Asia/Shanghai&quot;</span> &gt; /etc/timezone \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;BUILD_JAR_NAME&#125;</span>&quot;</span> \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; JAR_FILE_NAME=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$&#123;BUILD_JAR_NAME&#125;</span>&quot;</span>) \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;The jar file name is: <span class="variable">$&#123;JAR_FILE_NAME&#125;</span>&quot;</span></span></span><br><span class="line"><span class="comment"># 注意 RUN命令的运行结果变量JAR_FILE_NAME 是局部变量 到下一层读取的话是 null</span></span><br><span class="line"><span class="comment"># 所以我直接将 docker build 传入的 BUILD_JAR_NAME 变量作为环境变量，在启动脚本 startup.sh 中处理了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝jar包 及 脚本</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> <span class="variable">$BUILD_JAR_NAME</span> ./startup.sh <span class="variable">$BASE_DIR</span>/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x startup.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>,<span class="string">&quot;startup.sh&quot;</span>]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong><a href="http://startup.sh">startup.sh</a></strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印启动的文件名</span></span><br><span class="line">JAR_FILE_NAME=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$&#123;BUILD_JAR_NAME&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&gt; JAR_FILE_NAME: <span class="variable">$&#123;JAR_FILE_NAME&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -server -Xms<span class="variable">$&#123;JVM_XMS&#125;</span> -Xmx<span class="variable">$&#123;JVM_XMX&#125;</span> -Xmn<span class="variable">$&#123;JVM_XMN&#125;</span> -XX:MetaspaceSize=<span class="variable">$&#123;JVM_MS&#125;</span> -XX:MaxMetaspaceSize=<span class="variable">$&#123;JVM_MMS&#125;</span>&quot;</span></span><br><span class="line"><span class="comment"># debug 模式下参数配置（传输、端口号、调试服务器、不在 JVM 启动时暂停，而是等待调试器连接后再开始执行。）</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;MODE_DEBUG&#125;</span>&quot;</span> = <span class="string">&quot;y&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Xdebug -Xrunjdwp:transport=dt_socket,address=12345,server=y,suspend=n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># 异常处理机制 及 禁用大页面</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/java_heapdump.hprof&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -XX:-UseLargePages&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 垃圾回收 日志 轮换文件大小限制</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/logs&quot;</span> &amp;&amp; <span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/gc.log&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Xloggc:<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件编码 Redis等ip和密码 启动jar包</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Dfile.encoding=utf-8&quot;</span></span><br><span class="line"><span class="comment">#JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -DMYSQL_HOST=$&#123;MYSQL_HOST&#125; -DMYSQL_PORT=$&#123;MYSQL_PORT&#125; -DMYSQL_SERVICE_DB_NAME=$&#123;MYSQL_SERVICE_DB_NAME&#125; -DMYSQL_SERVICE_PASSWORD=$&#123;MYSQL_SERVICE_PASSWORD&#125;&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -jar <span class="variable">$&#123;BASE_DIR&#125;</span>/<span class="variable">$&#123;JAR_FILE_NAME&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This server is starting, you can docker logs your container&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;JAVA_OPT&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span>  <span class="variable">$JAVA</span> <span class="variable">$&#123;JAVA_OPT&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">GitLab仓库对多模块项目进行自动化构建。</summary>
    
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/categories/Web/"/>
    
    <category term="运维" scheme="https://www.kzmqvq.com/categories/Web/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="随手记" scheme="https://www.kzmqvq.com/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
    <category term="GitLab" scheme="https://www.kzmqvq.com/tags/GitLab/"/>
    
    <category term="CI自动化" scheme="https://www.kzmqvq.com/tags/CI%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    <category term="运维" scheme="https://www.kzmqvq.com/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>【Bug周刊】Vol.2</title>
    <link href="https://www.kzmqvq.com/posts/629535f3.html"/>
    <id>https://www.kzmqvq.com/posts/629535f3.html</id>
    <published>2024-03-13T08:03:11.000Z</published>
    <updated>2024-03-19T03:09:09.683Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近开发中遇到很多相同的问题，下意识去翻自己的历史记录，但又没能快速定位。我的<code>trilium</code>一直用来记录自己的周报和相关教程，对于常见的bug和修复方案也找不到合适的地方，只能穿插在日报的历史中，随时间沉没。无意间翻到子舒的奇趣周刊，Bug周刊也由此而生。</p><h2 id="github展示代码统计wakatime"><a class="markdownIt-Anchor" href="#github展示代码统计wakatime"></a> github展示代码统计（WakaTime）</h2><h3 id="问题描述"><a class="markdownIt-Anchor" href="#问题描述"></a> 问题描述</h3><p>我想要在<code>github</code>主页上添加 <code>WakaTime</code> 的代码统计，在配置了api的secret后，github action报错如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Run athul/waka-readme@master </span><br><span class="line">[2024-03-08 01:31:58] ln. 478 DEBUG    WakaReadme stats has changed</span><br><span class="line">[2024-03-08 01:31:58] ln. 522 CRITICAL 403 &#123;&quot;message&quot;: &quot;Resource not accessible by integration&quot;, &quot;documentation_url&quot;: &quot;https://docs.github.com/rest/repos/contents#create-or-update-file-contents&quot;&#125;</span><br></pre></td></tr></table></figure><h3 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案"></a> 解决方案</h3><p>1、检查 <code>waka-time.yml</code> 是否有误（<code>WAKATIME_API_KEY</code>）</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Waka</span> <span class="string">Readme</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="comment"># for manual workflow trigger</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="comment"># runs at 12 AM UTC (5:30 AM IST)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span> <span class="string">&quot;0 0 * * *&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">update-readme:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">WakaReadme</span> <span class="string">DevMetrics</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">athul/waka-readme@master</span> <span class="comment"># this action name</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">WAKATIME_API_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.WAKATIME_API_KEY</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>2、检查仓库的action是否有读写的权限</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/11/OpCi5XDjhElwosb.png" alt="" /></p><p>配置完毕后将会显示</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/08/2iVEXRKk1yMxAfh.png" alt="" /></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2024-03-11 08:04:18] ln. 300 DEBUG    The API data seems to be empty, please wait for a day</span><br></pre></td></tr></table></figure><p>只需要在你本地的编辑器（vscode、idea等）安装wakatime的插件，配置好key，继续你的日常coding，等一天就有数据产生了。</p><h3 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接"></a> 参考链接</h3><div class="tag link"><a class="link-card" title="美化github个人首页" href="https://zhuanlan.zhihu.com/p/426231957"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">美化github个人首页</p><p class="url">https://zhuanlan.zhihu.com/p/426231957</p></div></a></div><div class="tag link"><a class="link-card" title="waka-readme issue" href="https://github.com/athul/waka-readme/issues/141"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">waka-readme issue</p><p class="url">https://github.com/athul/waka-readme/issues/141</p></div></a></div><div class="tag link"><a class="link-card" title="No Activity tracked this week" href="https://github.com/athul/waka-readme/issues/26"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">No Activity tracked this week</p><p class="url">https://github.com/athul/waka-readme/issues/26</p></div></a></div><h2 id="wakatime-数据同步"><a class="markdownIt-Anchor" href="#wakatime-数据同步"></a> wakatime 数据同步</h2><h3 id="问题描述-2"><a class="markdownIt-Anchor" href="#问题描述-2"></a> 问题描述</h3><p>在获得wakatime的统计数据后，发现非会员用户只能获得14天的数据，我希望能够获取全部的数据，同时能够渲染成仪表盘。</p><h3 id="解决方案-2"><a class="markdownIt-Anchor" href="#解决方案-2"></a> 解决方案</h3><p>一台有docker环境的服务器，以 <code>docker-compose</code> 的方式部署<code>wakatime-sync</code>服务，我自己用的是宝塔，步骤如下：<br />1、在数据库中新建<code>wakatime</code>数据库，导入项目<code>sql</code>目录下的文件创建对应的数据表。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/13/mElgQXpA2wv3Syb.png" alt="" /></p><p>2、在宝塔中，按照 <code>docker -&gt; compose模版 -&gt; 添加</code>的步骤，将yml复制进去，修改对应的 <code>WAKATIME_APP_KEY</code> 和 <code>FTQQ_KEY</code>（需要去<a href="https://sct.ftqq.com">sever酱官网</a>&gt;注册获取），配置数据库的公网地址、端口号、账号和密码后，点击确定后保存。<br /><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/13/hv9sAFrXiotQqKT.png" alt="" /></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">wakatime-sync:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wf2311/wakatime-sync:1.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">wakatime-sync</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JAVA_OPTS=-Xmx256m</span> <span class="string">-Xms64m</span> <span class="string">-Xss256k</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=3040</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WAKATIME_APP_KEY=&lt;WAKATIME_APP_KEY&gt;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WAKATIME_PROXY_URL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WAKATIME_FTQQ_KEY=&lt;WAKATIME_FTQQ_KEY&gt;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WAKATIME_DINGDING_KEY=&lt;WAKATIME_DINGDING_KEY&gt;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">START_DAY=2016-02-01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_URL=jdbc:mysql://&lt;ip:port&gt;/wakatime?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=PRC</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USERNAME=wakatime</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=123456</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/Share/logs/wakatime-sync/:/application/logs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3040:3040&quot;</span></span><br></pre></td></tr></table></figure><p>3、点击 <code>compose -&gt; 添加compose项目</code>，选择对应模版后点击添加，再查看容器列表，确定镜像是否启动，正常情况下，每天早上9点就会推送昨天的wakatime数据。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/13/G79SkxyO1iYrJF6.png" alt="" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/13/yfOFqSvrt56AM9B.png" alt="" /></p><div class="note warning flat"><p>如果docker日志中出现 <code>unknownhost</code> 的报错，请注意配置服务器的host，在<code>/etc/host</code>文件中添加对应的ip，之后刷新DNS。比如:<br />143.198.244.187    <a href="http://wakatime.com">wakatime.com</a><br />49.233.102.57    <a href="http://sc.ftqq.com">sc.ftqq.com</a></p></div><div class="note primary flat"><p><strong>建议使用<code>docker-compose</code>的方式</strong><br />个人使用<code>docker run</code>的命令一直报错，手动建文件夹给777都没用，使用<code>docker-compose.yml</code>直接成功🎉🎉🎉</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/13/Jwu5v8iG179dUQH.png" alt="" /></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: error during container init: error mounting &quot;/root/logs/wakatime-sync&quot; to rootfs at &quot;/application/logs&quot;: open o_path procfd: open /var/lib/docker/overlay2/c249cef5b49bbe5e8395baf3618bd7dcdc995741016f2da57cc055734002d6be/merged/application/logs: not a directory: unknown: Are you trying to mount a directory onto a file (or vice-versa)? Check if the specified host path exists and is the expected type.</span><br></pre></td></tr></table></figure><h3 id="参考链接-2"><a class="markdownIt-Anchor" href="#参考链接-2"></a> 参考链接</h3><div class="tag link"><a class="link-card" title="wakatime-sync" href="https://gitee.com/wf2311/wakatime-sync"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">wakatime-sync</p><p class="url">https://gitee.com/wf2311/wakatime-sync</p></div></a></div><h2 id="github主页美化使用css"><a class="markdownIt-Anchor" href="#github主页美化使用css"></a> github主页美化使用css</h2><h3 id="问题描述-3"><a class="markdownIt-Anchor" href="#问题描述-3"></a> 问题描述</h3><p>我在我的主页上画了一个盒子，但是提交后盒子的代码以文本显示，没有渲染出来。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/14/CkmeLzE29KtFwXP.png" alt="" /></p><h3 id="解决方案-3"><a class="markdownIt-Anchor" href="#解决方案-3"></a> 解决方案</h3><p>1、将盒子的<code>style</code>转换成<code>svg</code>，以引入图片的方式解决渲染问题</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 800 200&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100vw&quot;</span> <span class="attr">height</span>=<span class="string">&quot;180&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">foreignObject</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 粘贴你的样式 --&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 粘贴你的盒子 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreignObject</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在readme文件中插入这个<code>svg</code>图片(<code>header.svg</code>)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./header.svg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;800&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、将盒子中的图片链接替换为<code>base64</code>，解决无法加载的问题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Refused to load the image because it violates the following Content Security Policy directive: &quot;default-src &#x27;none&#x27;&quot;</span><br><span class="line"></span><br><span class="line">Blocked script execution in because the document&#x27;s frame is sandboxed - Angular application</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/13/2gnsTkfrEH3bPoZ.png" alt="" /></p><h3 id="参考链接-3"><a class="markdownIt-Anchor" href="#参考链接-3"></a> 参考链接</h3><div class="tag link"><a class="link-card" title="github css-in-readme-like-wat" href="https://github.com/sindresorhus/css-in-readme-like-wat?tab=readme-ov-file"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">github css-in-readme-like-wat</p><p class="url">https://github.com/sindresorhus/css-in-readme-like-wat?tab=readme-ov-file</p></div></a></div><h2 id="合并ci中的shell命令"><a class="markdownIt-Anchor" href="#合并ci中的shell命令"></a> 合并CI中的shell命令</h2><p>书接上回，gitlab自动构建后，配置镜像对应的启动参数，补充对应的算法、垃圾回收日志、agent探针和对应debug模式参数配置</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk</span><br><span class="line"><span class="keyword">ENV</span> BASE_DIR=<span class="string">&quot;/app&quot;</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$BASE_DIR</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME=<span class="string">&quot;/usr/local/openjdk-8/&quot;</span> \</span><br><span class="line">    JAVA=<span class="string">&quot;/usr/local/openjdk-8/bin/java&quot;</span> \</span><br><span class="line">    JVM_XMS=<span class="string">&quot;8g&quot;</span> \</span><br><span class="line">    JVM_XMX=<span class="string">&quot;8g&quot;</span> \</span><br><span class="line">    JVM_XMN=<span class="string">&quot;3g&quot;</span> \</span><br><span class="line">    JVM_MS=<span class="string">&quot;128m&quot;</span> \</span><br><span class="line">    JVM_MMS=<span class="string">&quot;320m&quot;</span> \</span><br><span class="line">    HUSSAR_DEBUG=<span class="string">&quot;n&quot;</span> \</span><br><span class="line">    SW_AGENT=<span class="string">&quot;y&quot;</span> \</span><br><span class="line">    SW_AGENT_PATH=<span class="string">&quot;/home/skywalking/agent/&quot;</span> \</span><br><span class="line">    TZ=<span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">rm</span> -f /etc/localtime \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; <span class="built_in">ln</span> -sv /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Asia/Shanghai&quot;</span> &gt; /etc/timezone</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#install linux command tool</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; apt-get install -y vim  \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; apt-get install -y sudo \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; apt-get install -y nicstat \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; apt-get install -y sysstat \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; apt-get install -y inetutils-ping \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; apt-get install -y net-tools \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; apt-get install -y telnet</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只复制一次 减少构建层数</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./target/test-application.jar ./startup.sh <span class="variable">$BASE_DIR</span>/</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">7778</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x startup.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#RUN mkdir -p $SW_AGENT_PATH</span></span><br><span class="line"><span class="comment">#COPY agent $SW_AGENT_PATH</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>,<span class="string">&quot;startup.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#===========================================================================================</span></span><br><span class="line"><span class="comment"># JVM Configuration</span></span><br><span class="line"><span class="comment">#===========================================================================================</span></span><br><span class="line"><span class="comment"># 内存分配参数</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -server -Xms<span class="variable">$&#123;JVM_XMS&#125;</span> -Xmx<span class="variable">$&#123;JVM_XMX&#125;</span> -Xmn<span class="variable">$&#123;JVM_XMN&#125;</span> -XX:MetaspaceSize=<span class="variable">$&#123;JVM_MS&#125;</span> -XX:MaxMetaspaceSize=<span class="variable">$&#123;JVM_MMS&#125;</span>&quot;</span></span><br><span class="line"><span class="comment"># debug 模式下参数配置（传输、端口号、调试服务器、不在 JVM 启动时暂停，而是等待调试器连接后再开始执行。）</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;HUSSAR_DEBUG&#125;</span>&quot;</span> = <span class="string">&quot;y&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Xdebug -Xrunjdwp:transport=dt_socket,address=12345,server=y,suspend=n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># 异常处理机制 及 禁用大页面</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/java_heapdump.hprof&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -XX:-UseLargePages&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================================================</span></span><br><span class="line"><span class="comment"># Setting skywalking-agent properties</span></span><br><span class="line"><span class="comment"># agent 探针</span></span><br><span class="line"><span class="comment">#===========================================================================================</span></span><br><span class="line"><span class="comment">#if [ &quot;$&#123;SW_AGENT&#125;&quot; = &quot;y&quot; ]; then</span></span><br><span class="line"><span class="comment">#  JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -javaagent:$&#123;SW_AGENT_PATH&#125;/skywalking-agent.jar -DSW_AGENT_NAME=$&#123;SW_AGENT_NAME&#125; -DSW_AGENT_COLLECTOR_BACKEND_SERVICES=$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES&#125;&quot;</span></span><br><span class="line"><span class="comment">#fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 垃圾回收 日志 轮换文件大小限制</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/logs&quot;</span> &amp;&amp; <span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/gc.log&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Xloggc:<span class="variable">$&#123;BASE_DIR&#125;</span>/logs/gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件编码 Redis等ip和密码 启动jar包</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -Dfile.encoding=utf-8&quot;</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -jar <span class="variable">$&#123;BASE_DIR&#125;</span>/test-application.jar&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This server is starting, you can docker logs your container&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#if [ ! -n &quot;$WAIT_HOSTS&quot; ]; then</span></span><br><span class="line"><span class="comment">#  echo &quot;WAIT_HOSTS is not set!&quot;</span></span><br><span class="line"><span class="comment">#else</span></span><br><span class="line"><span class="comment">#  ./wait</span></span><br><span class="line"><span class="comment">#fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;JAVA_OPT&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span>  <span class="variable">$JAVA</span> <span class="variable">$&#123;JAVA_OPT&#125;</span></span><br></pre></td></tr></table></figure><h2 id="syntax-errorend-of-file-unexpectedexpecting-then"><a class="markdownIt-Anchor" href="#syntax-errorend-of-file-unexpectedexpecting-then"></a> Syntax error:end of file unexpected(expecting “then”)</h2><p>编写<code>dockerfile</code>和<code>startup.sh</code>文件时windows和linux下换行符冲突的问题；构建镜像时<code>ENV</code>配置错误</p>]]></content>
    
    
    <summary type="html">整理开发过程中遇到的bug及解决方案。</summary>
    
    
    
    <category term="Bug周刊" scheme="https://www.kzmqvq.com/categories/Bug%E5%91%A8%E5%88%8A/"/>
    
    
    <category term="Bug周刊" scheme="https://www.kzmqvq.com/tags/Bug%E5%91%A8%E5%88%8A/"/>
    
    <category term="随手记" scheme="https://www.kzmqvq.com/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>【Bug周刊】Vol.1</title>
    <link href="https://www.kzmqvq.com/posts/fb9c6449.html"/>
    <id>https://www.kzmqvq.com/posts/fb9c6449.html</id>
    <published>2024-02-26T09:54:56.000Z</published>
    <updated>2024-03-15T03:16:47.892Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近开发中遇到很多相同的问题，下意识去翻自己的历史记录，但又没能快速定位。我的<code>trilium</code>一直用来记录自己的周报和相关教程，对于常见的bug和修复方案也找不到合适的地方，只能穿插在日报的历史中，随时间沉没。无意间翻到子舒的奇趣周刊，Bug周刊也由此而生。</p><h2 id="hexo-command-not-found"><a class="markdownIt-Anchor" href="#hexo-command-not-found"></a> Hexo command not found</h2><h3 id="问题描述"><a class="markdownIt-Anchor" href="#问题描述"></a> 问题描述</h3><p>一段时间没有更新hexo博客，使用hexo的命令行时警告没有改命令，由于在几个月前配置过新电脑的环境并验证，所以可以排除是原来hexo博客迁移的问题，查找教程后，将博客文件目录下的 <code>/node_modules/.bin</code> 文件夹加入 <code>环境变量-&gt;系统变量-&gt;path</code> 中即可解决。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/02/27/ZxsaiSdHVEGPBy3.png" alt="" /></p><div class="note info flat"><p>注意：是<strong>博客源码文件夹</strong>下的<code>node_moudles/.bin</code> 不是安装nodejs的node_moudles，</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/02/27/RIxoUY6f1tLBOn3.png" alt="" /></p><h3 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接"></a> 参考链接</h3><div class="tag link"><a class="link-card" title="完美解决 bash: hexo: command not found" href="https://blog.csdn.net/qq_36759224/article/details/100411949"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">完美解决 bash: hexo: command not found</p><p class="url">https://blog.csdn.net/qq_36759224/article/details/100411949</p></div></a></div><h2 id="清理winsxs出错"><a class="markdownIt-Anchor" href="#清理winsxs出错"></a> 清理WinSxS出错</h2><h3 id="问题描述-2"><a class="markdownIt-Anchor" href="#问题描述-2"></a> 问题描述</h3><p>使用dism++进行空间回收时，勾选“被取代的WinSxS组件”出错，无法正常进行清理，这是版本的bug，<strong>更新版本至10.1.1002.1或更高版本</strong>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/02/27/nBQjzp39yS84Aei.png" alt="" /></p><h3 id="参考链接-2"><a class="markdownIt-Anchor" href="#参考链接-2"></a> 参考链接</h3><div class="tag link"><a class="link-card" title="dism++ issues" href="https://github.com/Chuyu-Team/Dism-Multi-language/issues/867"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">dism++ issues</p><p class="url">https://github.com/Chuyu-Team/Dism-Multi-language/issues/867</p></div></a></div><div class="tag link"><a class="link-card" title="【Dism++】“被取代的WinSxS组件”清理出错怎么办" href="https://zhuanlan.zhihu.com/p/675305615"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">【Dism++】“被取代的WinSxS组件”清理出错怎么办</p><p class="url">https://zhuanlan.zhihu.com/p/675305615</p></div></a></div><h2 id="neterr_blocked_by_client"><a class="markdownIt-Anchor" href="#neterr_blocked_by_client"></a> net::ERR_BLOCKED_BY_CLIENT</h2><h3 id="问题描述-3"><a class="markdownIt-Anchor" href="#问题描述-3"></a> 问题描述</h3><p>自己的博客f12后查看命令行，总是有几个插件报出<code>net::ERR_BLOCKED_BY_CLIENT</code>的错误，一直没有解决，但是打开纯净模式的edge后没有任何问题，于是推断是谷歌拓展插件的问题。</p><p>在workflow上了解到， AdBlockers 有一些规则，即它们将 URI 与某种类型的表达式进行匹配，对我插件的链接产生了误报。<br />最常见的方式就是将博客的地址加入<code>AdBlockers</code>的<strong>白名单</strong>中即可解决。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/02/27/a6KqAb9f5rGcBuO.png" alt="" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/02/27/zSy6ZD5EbfJFNUL.png" alt="" /></p><h3 id="参考链接-3"><a class="markdownIt-Anchor" href="#参考链接-3"></a> 参考链接</h3><div class="tag link"><a class="link-card" title="workflow: net::ERR_BLOCKED_BY_CLIENT" href="https://stackoverflow.com/questions/23341765/getting-neterr-blocked-by-client-error-on-some-ajax-calls"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">workflow: net::ERR_BLOCKED_BY_CLIENT</p><p class="url">https://stackoverflow.com/questions/23341765/getting-neterr-blocked-by-client-error-on-some-ajax-calls</p></div></a></div><h2 id="修改yarn全局安装和缓存位置"><a class="markdownIt-Anchor" href="#修改yarn全局安装和缓存位置"></a> 修改yarn全局安装和缓存位置</h2><h3 id="问题描述-4"><a class="markdownIt-Anchor" href="#问题描述-4"></a> 问题描述</h3><p>最近c盘一下子少了20g，<code>SpaceSniffer</code> 检查扫描后发现页面休眠文件过大，教程解释c盘分配的虚拟内存过大，可我最近玩幻兽帕鲁防止虚幻5崩溃特意调高的虚拟内存，得，不能动。</p><p>清理c盘中yarn安装插件包留下的缓存，一下子c盘多了4g，再用dism++清理WinSxS组件，又释放了4个g。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改yarn安装包的位置</span></span><br><span class="line">yarn config  <span class="built_in">set</span> global-folder <span class="string">&quot;F:\Program\yarn\global&quot;</span></span><br><span class="line"><span class="comment"># 查看 yarn 全局安装位置</span></span><br><span class="line">yarn global <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改缓存的位置</span></span><br><span class="line">yarn config <span class="built_in">set</span> cache-folder <span class="string">&quot;F:\Program\yarn\cache&quot;</span></span><br><span class="line"><span class="comment"># 查看 yarn 全局cache位置</span></span><br><span class="line">yarn cache <span class="built_in">dir</span></span><br></pre></td></tr></table></figure><h2 id="mindoc本地部署"><a class="markdownIt-Anchor" href="#mindoc本地部署"></a> minDoc本地部署</h2><h3 id="问题描述-5"><a class="markdownIt-Anchor" href="#问题描述-5"></a> 问题描述</h3><p>需要一个管理产品文档的工具，同时具有<strong>权限管理、成员管理</strong>的功能，可根据文件（夹）结构自动生成侧边栏。</p><h3 id="参考链接-4"><a class="markdownIt-Anchor" href="#参考链接-4"></a> 参考链接</h3><div class="tag link"><a class="link-card" title="minDoc部署文档" href="https://mindoc.com.cn/docs/mindochelp"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">minDoc部署文档</p><p class="url">https://mindoc.com.cn/docs/mindochelp</p></div></a></div><h2 id="css实现hover后的渐变效果"><a class="markdownIt-Anchor" href="#css实现hover后的渐变效果"></a> css实现hover后的渐变效果</h2><h3 id="问题描述-6"><a class="markdownIt-Anchor" href="#问题描述-6"></a> 问题描述</h3><p>通过css实现鼠标悬停后图片逐渐放大的效果，增加页面的交互感。<br /><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/03/07/xm6CcJ5NiKILj7y.gif" alt="" /></p><h3 id="代码"><a class="markdownIt-Anchor" href="#代码"></a> 代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>鼠标悬停图片逐渐放大<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    * &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100vw</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.card</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">flex-direction</span>: row;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">justify-content</span>: space-evenly;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">3px</span> <span class="number">8px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">17</span>, <span class="number">27</span>, <span class="number">0.05</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transition</span>: transform <span class="number">0.3s</span> ease;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.card</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">3px</span> <span class="number">8px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">17</span>, <span class="number">27</span>, <span class="number">0.09</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.card</span> <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">180px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transition</span>: transform <span class="number">0.3s</span> ease;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.card</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.05</span>)</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.card</span> <span class="selector-class">.content</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.sa.net/2024/03/05/nmOrdsI4N9KebGi.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>这是测试文本<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="patch-package-给插件打补丁"><a class="markdownIt-Anchor" href="#patch-package-给插件打补丁"></a> patch-package 给插件打补丁</h2><h3 id="问题描述-7"><a class="markdownIt-Anchor" href="#问题描述-7"></a> 问题描述</h3><p>使用vuepress 1.8 版本搭建说明文档，想实现一个加密的效果，使用npm仓库的<code>vuepress-plugin-posts-encrypt</code>插件，但是部署后访问缓慢，打开控制台查看资源加载速度后，发现该插件引入的静态资源使用的是jsd加速？？？？？</p><p>果断在插件内全局替换<code>iview.min.js</code>、<code>iview.css</code>和<code>vue.min.js</code>的链接为字节的静态资源库加速，丝滑访问，为了避免每次npm install后又要重新替换，引入了<code>patch-package</code>。安装步骤见参考链接。</p><p>需要注意，在执行 <code>npx patch-package vuepress-plugin-posts-encrypt(修改包的名字)</code>前需要修改源码，执行命令后可能会等待一段时间才会显示出对应的patch文件，<code>be patient please 😊</code></p><h3 id="参考链接-5"><a class="markdownIt-Anchor" href="#参考链接-5"></a> 参考链接</h3><div class="tag link"><a class="link-card" title="字节跳动静态资源库 加快资源访问速度" href="https://cdn.bytedance.com/"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">字节跳动静态资源库 加快资源访问速度</p><p class="url">https://cdn.bytedance.com/</p></div></a></div><div class="tag link"><a class="link-card" title="给修改的 node_modules 下源码“打补丁”" href="https://blog.csdn.net/IAIPython/article/details/130571222"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">给修改的 node_modules 下源码“打补丁”</p><p class="url">https://blog.csdn.net/IAIPython/article/details/130571222</p></div></a></div><h2 id="gitlab-ci"><a class="markdownIt-Anchor" href="#gitlab-ci"></a> gitlab-ci</h2><h3 id="问题描述-8"><a class="markdownIt-Anchor" href="#问题描述-8"></a> 问题描述</h3><p>需要对一个<code>maven</code>项目进行自动化构建，要求每次提交都会触发构建，减少运维的工作量，将构建好的jar包打包成docker镜像并推送至私有的镜像仓库</p><p>详情如下：</p><p>1、自定义开发的<code>common</code>模块并不完善，也没有上传至私有的<code>nexus</code>仓库，需要打包的功能模块依赖于<code>common</code></p><p>2、项目依赖的部分<code>jar</code>包需要从私有的<code>nexus</code>仓库下载，需要配置对应的仓库地址</p><p>3、构建时间的优化、提升</p><h3 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案"></a> 解决方案</h3><p>1、在代码仓库中增加 <code>.m2/settings.xml</code> 文件，配置对应的私有nexus仓库地址、阿里云或者腾讯云的nexus地址提升下载速度</p><p>2、增加 <code>localReposity</code> 配置，告诉maven在找不到对应<code>jar</code> 包时，从本地读取，完成<code>common</code>模块的引入。由于common模块是独立开发的，故和其他模块的pom父类并不一致，各个模块也有不同的配置，在原项目根目录下并没有pom文件，所以不能通过构建根pom文件的方式完成项目的打包。</p><p>3、引入cache</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">RELEASE_TAG:</span> <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">  <span class="attr">MAVEN_CLI_OPTS:</span> <span class="string">&quot;../.m2/settings.xml --batch-mode -Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">$&#123;CI_COMMIT_REF_SLUG&#125;</span> <span class="comment"># cache键值对 减少mvn下载jar包的时间 key指向当前项目分支</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">~/.m2/repository/</span> <span class="comment"># 缓存地址 镜像根目录下的 .m2/repository/ 文件夹</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">target/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CI构建两步</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">package</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">release</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在maven镜像中构建jar包</span></span><br><span class="line"><span class="attr">package:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">maven:3.6.1-jdk-8-alpine</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">package</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span> <span class="comment"># 触发构建的分支</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cd</span> <span class="string">test-common</span> <span class="comment"># 进入common模块打包</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">-s</span> <span class="string">$MAVEN_CLI_OPTS</span> <span class="string">-e</span> <span class="string">package</span> <span class="string">install</span> <span class="comment"># 打包 并将打包后生成的jar下载至 镜像根目录.m2/repository/路径下(本地仓库)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cd</span> <span class="string">../test-app</span> <span class="comment"># 切出common 打包其他模块</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">-s</span> <span class="string">$MAVEN_CLI_OPTS</span> <span class="string">-e</span> <span class="string">package</span></span><br><span class="line">  <span class="attr">artifacts:</span> <span class="comment"># 构建好的jar文件上传 并设置过期时间</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test-app/target/test-app-application-exec.jar</span></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">1</span> <span class="string">hours</span></span><br><span class="line"></span><br><span class="line"><span class="attr">release:</span> <span class="comment"># docker in docker 在docker中构建jar为docker镜像</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">docker:20-dind</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">release</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker-slim</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">login</span> <span class="string">--username=username</span> <span class="string">-p</span> <span class="string">$REPOS_PASSWORD</span> <span class="string">test.com</span> <span class="comment"># 配置私有镜像仓库的账号 密码 地址</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">df</span> <span class="string">-h</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">-t</span> <span class="string">test/test-app:$RELEASE_TAG</span> <span class="string">.</span> <span class="comment"># docker镜像标签</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">push</span> <span class="string">test.com/test-image/test-app:$RELEASE_TAG</span> <span class="comment"># 推送</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">整理开发过程中遇到的bug及解决方案。</summary>
    
    
    
    <category term="Bug周刊" scheme="https://www.kzmqvq.com/categories/Bug%E5%91%A8%E5%88%8A/"/>
    
    
    <category term="Bug周刊" scheme="https://www.kzmqvq.com/tags/Bug%E5%91%A8%E5%88%8A/"/>
    
    <category term="随手记" scheme="https://www.kzmqvq.com/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】docker搭建wordpress</title>
    <link href="https://www.kzmqvq.com/posts/cf3334e.html"/>
    <id>https://www.kzmqvq.com/posts/cf3334e.html</id>
    <published>2024-02-26T08:16:35.000Z</published>
    <updated>2024-02-26T09:42:26.680Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近外快需要，重新部署了<code>wordpress</code>，因为是小水管，自然想到了<code>docker</code>，在我不需要演示的时候可以停掉相应的服务，而且停掉后不用担心部署其他服务时端口冲突的问题，这样我的<code>nacos</code>和<code>nexus</code>都不会受到影响🎉。环境是腾讯云的宝塔镜像。</p><h2 id="部署过程"><a class="markdownIt-Anchor" href="#部署过程"></a> 部署过程</h2><p>1、提前开放<strong>宝塔防火墙</strong>和<strong>腾讯云服务器的防火墙</strong>的3306、8080、80端口 （宝塔里面开三个、腾讯云安全组里再开相同的三个）</p><p>2、新建并启动MySQL容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker container run \</span><br><span class="line">  -d \</span><br><span class="line">  --name wordpressdb \</span><br><span class="line">  --<span class="built_in">env</span> MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">  --<span class="built_in">env</span> MYSQL_DATABASE=wordpress \</span><br><span class="line">  mysql:5.7</span><br></pre></td></tr></table></figure><p>3、新建并启动WordPress容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker container run \</span><br><span class="line">  -d \</span><br><span class="line">  -p 8080:80 \</span><br><span class="line">  --name wordpress \</span><br><span class="line">  --<span class="built_in">env</span> WORDPRESS_DB_PASSWORD=123456 \</span><br><span class="line">  --<span class="built_in">link</span> wordpressdb:mysql \</span><br><span class="line">  --volume <span class="string">&quot;<span class="variable">$PWD</span>/wordpress&quot;</span>:/var/www/html \</span><br><span class="line">  wordpress</span><br></pre></td></tr></table></figure><p>4、修改WordPress的数据库配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-16-16-centos ~]<span class="comment"># vim wordpress/wp-config.php</span></span><br></pre></td></tr></table></figure><p>进入配置文件后，修改下列内容（第2、3、4步的密码记得改啊，别真搞123456）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ** MySQL settings - You can get this info from your web host ** //</span></span><br><span class="line"><span class="comment">/** The name of the database for WordPress */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="title function_ invoke__">getenv_docker</span>(<span class="string">&#x27;WORDPRESS_DB_NAME&#x27;</span>, <span class="string">&#x27;wordpress&#x27;</span>) );</span><br><span class="line"><span class="comment">/** MySQL database username */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="title function_ invoke__">getenv_docker</span>(<span class="string">&#x27;WORDPRESS_DB_USER&#x27;</span>, <span class="string">&#x27;root&#x27;</span>) );</span><br><span class="line"><span class="comment">/** MySQL database password */</span></span><br><span class="line"><span class="title function_ invoke__">define</span>( <span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="title function_ invoke__">getenv_docker</span>(<span class="string">&#x27;WORDPRESS_DB_PASSWORD&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>) );</span><br></pre></td></tr></table></figure><p>保存后退出（按<code>esc</code>， 输入 <code>:wq</code> 保存后退出）</p><hr /><p>这里访问 你的服务器公网ip地址:8080（类似 127.0.0.1:8080），进入WordPress安装界面，就可以完成初始化，正常访问写文章了。</p><p>我没有在docker安装命令中加<code>--rm</code>，这会在停止容器后自动删除镜像，与需求不符。</p><p><code>WORDPRESS_DB_PASSWORD=123456</code>、<code>MYSQL_ROOT_PASSWORD=123456</code>、<code>getenv_docker('WORDPRESS_DB_PASSWORD', '123456')</code>中的<code>123456</code>记得改成复杂点的密码。当然，不改也能跑🤣</p><h2 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接"></a> 参考链接</h2><div class="tag link"><a class="link-card" title="Docker五分钟搭建Wordpress" href="https://developer.aliyun.com/article/900120"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Docker五分钟搭建Wordpress</p><p class="url">https://developer.aliyun.com/article/900120</p></div></a></div> <h2 id="个人主题配置"><a class="markdownIt-Anchor" href="#个人主题配置"></a> 个人主题配置</h2><p>主题：Freshblog Newsfeed</p><p>启用顶部图、禁用侧栏、修改顶部图样式、修改页脚的背景色及内容、设置layout的文章为三列，效果如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/02/26/2X7aiJ1ovkxZlNu.png" alt="" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/02/26/GRU78QJ64es9ZAy.png" alt="" /></p><p>主题编辑器，将WordPress登录后顶部的黑边消除掉：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sa.net/2024/02/26/nuQyeEqmk9d2sHt.png" alt="image-20240226173409143" /></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_admin_bar</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">使用docker完成wordpress快速建站，并实现主题页面初始化。</summary>
    
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/categories/Web/"/>
    
    <category term="docker" scheme="https://www.kzmqvq.com/categories/Web/docker/"/>
    
    
    <category term="随手记" scheme="https://www.kzmqvq.com/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
    <category term="docker" scheme="https://www.kzmqvq.com/tags/docker/"/>
    
    <category term="wordpress" scheme="https://www.kzmqvq.com/tags/wordpress/"/>
    
  </entry>
  
  <entry>
    <title>【JavaWeb】mybatis基础</title>
    <link href="https://www.kzmqvq.com/posts/417eb291.html"/>
    <id>https://www.kzmqvq.com/posts/417eb291.html</id>
    <published>2023-10-14T12:16:28.000Z</published>
    <updated>2024-02-20T02:54:35.548Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>记录学习JavaWeb课程中的部分知识点，包括maven依赖管理、maven高阶、Mybatis、SpringBoot自动配置等。本篇是关于mybatis的相关配置，以实现对数据的增删改查功能。</p><h2 id="mybatis增删改查"><a class="markdownIt-Anchor" href="#mybatis增删改查"></a> MyBatis增删改查</h2><h3 id="相关配置"><a class="markdownIt-Anchor" href="#相关配置"></a> 相关配置</h3><ol><li>准备数据库表emp，sql代码如下：</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">     id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">     name <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">     age tinyint unsigned comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">     gender tinyint unsigned comment <span class="string">&#x27;性别, 1:男, 2:女&#x27;</span>,</span><br><span class="line">     phone <span class="type">varchar</span>(<span class="number">11</span>) comment <span class="string">&#x27;手机号&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;用户表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;白眉鹰王&#x27;</span>,<span class="number">55</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;金毛狮王&#x27;</span>,<span class="number">45</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000001&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;青翼蝠王&#x27;</span>,<span class="number">38</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000002&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;紫衫龙王&#x27;</span>,<span class="number">42</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;18800000003&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;光明左使&#x27;</span>,<span class="number">37</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000004&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;光明右使&#x27;</span>,<span class="number">48</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000005&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 部门管理</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">     id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">     name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">     create_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">     update_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (id, name, create_time, update_time) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;学工部&#x27;</span>,now(),now()),(<span class="number">2</span>,<span class="string">&#x27;教研部&#x27;</span>,now(),now()),(<span class="number">3</span>,<span class="string">&#x27;咨询部&#x27;</span>,now(),now()), (<span class="number">4</span>,<span class="string">&#x27;就业部&#x27;</span>,now(),now()),(<span class="number">5</span>,<span class="string">&#x27;人事部&#x27;</span>,now(),now());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工管理</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp (</span><br><span class="line">     id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">     username <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">     password <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">default</span> <span class="string">&#x27;123456&#x27;</span> comment <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">     name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">     gender tinyint unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;性别, 说明: 1 男, 2 女&#x27;</span>,</span><br><span class="line">     image <span class="type">varchar</span>(<span class="number">300</span>) comment <span class="string">&#x27;图像&#x27;</span>,</span><br><span class="line">     job tinyint unsigned comment <span class="string">&#x27;职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师&#x27;</span>,</span><br><span class="line">     entrydate <span class="type">date</span> comment <span class="string">&#x27;入职时间&#x27;</span>,</span><br><span class="line">     dept_id <span class="type">int</span> unsigned comment <span class="string">&#x27;部门ID&#x27;</span>,</span><br><span class="line">     create_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">     update_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(id, username, password, name, gender, image, job, entrydate,dept_id, create_time, update_time) <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="string">&#x27;jinyong&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;金庸&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;2000-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">    (<span class="number">2</span>,<span class="string">&#x27;zhangwuji&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;张无忌&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2015-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">    (<span class="number">3</span>,<span class="string">&#x27;yangxiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;杨逍&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;3.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2008-05-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">    (<span class="number">4</span>,<span class="string">&#x27;weiyixiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;韦一笑&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;4.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2007-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">    (<span class="number">5</span>,<span class="string">&#x27;changyuchun&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;常遇春&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;5.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2012-12-05&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">    (<span class="number">6</span>,<span class="string">&#x27;xiaozhao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;小昭&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;6.jpg&#x27;</span>,<span class="number">3</span>,<span class="string">&#x27;2013-09-05&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">    (<span class="number">7</span>,<span class="string">&#x27;jixiaofu&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;纪晓芙&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;7.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2005-08-01&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">    (<span class="number">8</span>,<span class="string">&#x27;zhouzhiruo&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;周芷若&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;8.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2014-11-09&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">    (<span class="number">9</span>,<span class="string">&#x27;dingminjun&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;丁敏君&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;9.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2011-03-11&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">    (<span class="number">10</span>,<span class="string">&#x27;zhaomin&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;赵敏&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;10.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2013-09-05&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">    (<span class="number">11</span>,<span class="string">&#x27;luzhangke&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;鹿杖客&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;11.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2007-02-01&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">    (<span class="number">12</span>,<span class="string">&#x27;hebiweng&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;鹤笔翁&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;12.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2008-08-18&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">    (<span class="number">13</span>,<span class="string">&#x27;fangdongbai&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;方东白&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;13.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2012-11-01&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">    (<span class="number">14</span>,<span class="string">&#x27;zhangsanfeng&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;张三丰&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;14.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2002-08-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">    (<span class="number">15</span>,<span class="string">&#x27;yulianzhou&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;俞莲舟&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;15.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2011-05-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">    (<span class="number">16</span>,<span class="string">&#x27;songyuanqiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;宋远桥&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;16.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2010-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">    (<span class="number">17</span>,<span class="string">&#x27;chenyouliang&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;陈友谅&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;17.jpg&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;2015-03-21&#x27;</span>,<span class="keyword">NULL</span>,now(),now());</span><br></pre></td></tr></table></figure><ol start="2"><li>创建一个新的springboot工程，选择引入对应的依赖，如mybatis、mysql驱动、lombok</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/14/oKCfBMvc5jbPN2u.png" alt="image-20231014205542023" /></p><p>其实最方便的还是新建一个空的maven项目，直接把依赖配置粘贴上去（pom.xml）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>02-springboot-mybatis-crud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>application.properties中引入数据库连接信息</li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置数据库的连接信息 - 四要素</span></span><br><span class="line"><span class="comment">#驱动类名称</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">#数据库连接的url</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="comment">#连接数据库的用户名</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#连接数据库的密码</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#开启mybatis日志 并输出至控制台</span></span><br><span class="line"><span class="attr">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><ol start="4"><li>创建对应的实体类Emp（实体类属性采用驼峰命名）</li></ol><p>构造该实体类时使用了lombok中的@Data、@NoArgsConstructor及@AllArgsConstructor，简化了无参和带有各参数的构造，避免重复使用<code>alt + insert</code>生成。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/14/evol7HVLYErK2sh.png" alt="" /></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id; <span class="comment">// ID</span></span><br><span class="line">    <span class="keyword">private</span> String username; <span class="comment">// 用户名</span></span><br><span class="line">    <span class="keyword">private</span> String password; <span class="comment">// 密码</span></span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">// 姓名</span></span><br><span class="line">    <span class="keyword">private</span> Short gender; <span class="comment">// 性别, 1 男, 2 女</span></span><br><span class="line">    <span class="keyword">private</span> String image; <span class="comment">// 图像url</span></span><br><span class="line">    <span class="keyword">private</span> Short job; <span class="comment">// 职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师&#x27;</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate entrydate; <span class="comment">// 入职日期</span></span><br><span class="line">    <span class="keyword">private</span> Integer deptId; <span class="comment">// 部门ID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime; <span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime; <span class="comment">// 修改时间</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>准备Mapper接口 EmpMapper</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完成后的项目结构如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/14/nkbfitHe5lN4F7X.png" alt="image-20231014204435761" /></p><h3 id="增加"><a class="markdownIt-Anchor" href="#增加"></a> 增加</h3><p>emp表的内容如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/14/aqWvY15gdzEP3JK.png" alt="image-20231014224949194" /></p><p>如果需要新增数据，sql语句应为：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp(username, name, gender, image, job, entrydate, dept_id, create_time, update_time) <span class="keyword">values</span> (<span class="string">&#x27;songyuanqiao&#x27;</span>,<span class="string">&#x27;宋远桥&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2012-10-09&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2022-10-01 10:00:00&#x27;</span>,<span class="string">&#x27;2022-10-01 10:00:00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>对应的接口方法为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into emp(username, name, gender, image, job, entrydate, dept_id, create_time, update_time) values (#&#123;username&#125;, #&#123;name&#125;, #&#123;gender&#125;, #&#123;image&#125;, #&#123;job&#125;, #&#123;entrydate&#125;, #&#123;deptId&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Emp emp)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="参数占位符"><a class="markdownIt-Anchor" href="#参数占位符"></a> 参数占位符</h4><p><code>#&#123;…&#125;</code>为MyBatis的<strong>参数占位符</strong>，还有一种形式为<code>$&#123;…&#125;</code>。需要注意花括号中的名称是<strong>对象的属性名</strong>(采用驼峰命名)，不是数据库中的字段名。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/9ICRKcPeoz76mvf.png" alt="参数占位符" /></p><blockquote><p>在项目开发中，建议使用#{…}，生成预编译SQL，防止SQL注入安全。</p></blockquote><h4 id="预编译sql"><a class="markdownIt-Anchor" href="#预编译sql"></a> 预编译SQL</h4><p><strong>预编译SQL</strong>可以提升性能，将sql语句参数化，编译一次之后会将编译后的SQL语句缓存起来，可多次运行，不需要对相同的sql语句做重复编译。同时将敏感字进行转义，保障SQL的安全性。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/13FLBIPkiKT5RpA.png" alt="" /></p><h4 id="主键返回"><a class="markdownIt-Anchor" href="#主键返回"></a> 主键返回</h4><p>如果需要在添加数据后，返回该数据对应数据表中的主键(id)，只需要添加如下注解。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//会自动将生成的主键值，赋值给emp对象的id属性</span></span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true,keyProperty = &quot;id&quot;)</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/xLZvr6Op7QABYeR.png" alt="" /></p><h3 id="删除"><a class="markdownIt-Anchor" href="#删除"></a> 删除</h3><p>根据主键删除数据，sql语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">17</span>;</span><br></pre></td></tr></table></figure><p>接口方法如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Delete(&quot;delete from emp where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改"><a class="markdownIt-Anchor" href="#修改"></a> 修改</h3><p>根据主键修改数据，与增加数据的方式相同，sql语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> emp <span class="keyword">set</span> username <span class="operator">=</span> <span class="string">&#x27;linghushaoxia&#x27;</span>, name <span class="operator">=</span> <span class="string">&#x27;令狐少侠&#x27;</span>, gender <span class="operator">=</span> <span class="number">1</span> , image <span class="operator">=</span> <span class="string">&#x27;1.jpg&#x27;</span> , job <span class="operator">=</span> <span class="number">2</span>, entrydate <span class="operator">=</span> <span class="string">&#x27;2012-01-01&#x27;</span>, dept_id <span class="operator">=</span> <span class="number">2</span>, update_time <span class="operator">=</span> <span class="string">&#x27;2022-10-01 12:12:12&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">18</span>;</span><br></pre></td></tr></table></figure><p>接口方法如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Update(&quot;update emp set username = #&#123;username&#125;, name = #&#123;name&#125;, gender = #&#123;gender&#125;, image = #&#123;image&#125;,&quot; + &quot; job = #&#123;job&#125;, entrydate = #&#123;entrydate&#125;, dept_id = #&#123;deptId&#125;,update_time = #&#123;updateTime&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Emp emp)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查询"><a class="markdownIt-Anchor" href="#查询"></a> 查询</h3><p>根据主键查询数据，sql语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/Q3BhtMS6G8HmNJ5.png" alt="" /></p><p>查询结果中的deptId、createTime、updateTime为空， 因为数据表中的字段与实体类中的属性名不一致，导致mybatis不能自动封装。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/en1FKW63yc2k8vx.png" alt="" /></p><p><strong>解决方案</strong>：</p><ol><li>字段起别名</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/QZH7pjTUAfOY5eS.png" alt="" /></p><ol start="2"><li>@Results注解</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/qkzvNF5KVXa6xyg.png" alt="" /></p><ol start="3"><li>开启mybatis驼峰命名法自动映射开关</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/aI7eqgLDwn2QJkx.png" alt="" /></p><h4 id="条件查询"><a class="markdownIt-Anchor" href="#条件查询"></a> 条件查询</h4><p>在实际使用中，我们可能需要根据姓名、性别、入职时间及最后修改时间多项条件对员工表进行模糊查询，</p><ul><li><p>姓名：要求支持模糊匹配</p></li><li><p>性别：要求精确匹配</p></li><li><p>入职时间：要求进行范围查询</p></li><li><p>根据最后修改时间进行降序排序</p></li></ul><p>可能使用的sql语句示例如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time <span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%张%&#x27;</span> </span><br><span class="line"><span class="keyword">and</span> gender <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">and</span> entrydate <span class="keyword">between</span> <span class="string">&#x27;2010-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2020-01-01 &#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> update_time <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p>对应两种可以使用的接口方法：</p><p>第一种（使用${…}进行字符串拼接）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from emp where name like &#x27;%$&#123;name&#125;%&#x27; and gender = #&#123;gender&#125; and &quot; +</span></span><br><span class="line"><span class="meta">       &quot;entrydate between #&#123;begin&#125; and #&#123;end&#125; order by update_time desc &quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">(String name, Short gender, LocalDate begin , LocalDate end)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>该方法并不是预编译的形式，所以效率不高、且存在sql注入风险。</p><p>第二种（使用MySQL提供的字符串拼接函数concat）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from emp where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;) and gender = #&#123;gender&#125; and &quot; +</span></span><br><span class="line"><span class="meta">        &quot;entrydate between #&#123;begin&#125; and #&#123;end&#125; order by update_time desc &quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">(String name, Short gender, LocalDate begin , LocalDate end)</span>;</span><br></pre></td></tr></table></figure><p>函数：concat(’%’ , ‘关键字’ , ‘%’)，此方法生成的SQL都是预编译的SQL语句（性能高、安全）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/gZEuWQJCzhAvXxU.png" alt="image-20231015210307268" /></p><blockquote><p>需要注意编写代码中的参数名规范，保证接口中方法的形参名和SQL语句中的参数占位符名相同。参数名在不同的SpringBoot版本中，处理方案也不同。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/vSCIqElsB5QK739.png" alt="" /></p><h4 id="xml映射文件"><a class="markdownIt-Anchor" href="#xml映射文件"></a> xml映射文件</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/7kwiULE6y8Gpu2V.png" alt="" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/bhVPWZrYlR2v1d3.png" alt="" /></p><p>通过id（对应的方法）找到对应的sql语句 来完成数据库的操作</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/Rfr6VaqvhS53ELc.png" alt="" /></p><p><a href="https://mybatis.net.cn/getting-started.html">https://mybatis.net.cn/getting-started.html</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/ibEdGAg89YL3eVR.png" alt="" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/10/15/j2ao4hYqbekzKZA.jpg" alt="" /></p>]]></content>
    
    
    <summary type="html">记录学习JavaWeb课程中的部分知识点，包括maven依赖管理、maven高阶、Mybatis、SpringBoot自动配置等。</summary>
    
    
    
    <category term="JavaWeb" scheme="https://www.kzmqvq.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="https://www.kzmqvq.com/tags/JavaWeb/"/>
    
    <category term="后端" scheme="https://www.kzmqvq.com/tags/%E5%90%8E%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>【JavaWeb】maven依赖管理</title>
    <link href="https://www.kzmqvq.com/posts/63fd83a3.html"/>
    <id>https://www.kzmqvq.com/posts/63fd83a3.html</id>
    <published>2023-09-25T11:01:15.000Z</published>
    <updated>2023-09-25T11:23:41.291Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>记录学习JavaWeb课程中的部分知识点，包括maven依赖管理、maven高阶、Mybatis、SpringBoot自动配置等。本篇是关于maven对依赖包管理的内容。</p><h2 id="maven依赖管理"><a class="markdownIt-Anchor" href="#maven依赖管理"></a> maven依赖管理</h2><h3 id="依赖配置"><a class="markdownIt-Anchor" href="#依赖配置"></a> 依赖配置</h3><p>在项目的 <code>pom.xml</code> 中配置对应的依赖（当前项目运行需要的 <code>jar</code> 包），包括项目组织名、依赖包名及对应版本。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupld</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupld</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactld</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactld</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupld</span>&gt;</span>...<span class="tag">&lt;/<span class="name">groupld</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactld</span>&gt;</span>...<span class="tag">&lt;/<span class="name">artifactld</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>...<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p><code>groupid</code>和<code>artifactId</code>被统称为“坐标”，是为了保证项目唯一性而提出的，如果你要把你项目弄到maven本地仓库去，你想要找到你的项目就必须根据这两个id去查找。</p></li><li><p><code>groupId</code>：<code>groupId</code>分为几个字段，例如 <code>org.apache.tomcat</code> ，前面的 org 叫做域，后面的是项目组织者起的域名，<code>tomcat.apache.org</code>正是<code>tomcat</code>的官网。</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/09/19/Slk68WdXzsixbH3.png" alt="tomcat依赖" /></p><ul><li><code>artifactId</code>：<code>artifactId</code>一般是项目名或者模块名。（可以浅显地理解为 依赖包的名称）</li></ul><blockquote><p>域又分为org、com、cn等等许多，其中org为非营利组织，com为商业组织。举个apache公司的tomcat项目例子：这个项目的groupId是org.apache.tomcat，它的域是org（因为tomcat是非营利项目），公司名称是apache，artigactId是tomcat。</p></blockquote><div class="note primary flat"><p>一般来说，包名根目录 = groupId + artifactId。这个是不允许和别人重复的，尤其是需要上线的项目。一般公司为了不重复都会注册一个域名（URL用的那种），这样就肯定不会重复了。</p></div><p>配置完成后，点击maven管理的刷新按钮，即可载入对应依赖（从本地仓库引入 或者 从远程仓库下载后引入）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/09/19/Y5g4FX82Uw7SyNo.png" alt="载入依赖注意事项" /></p><h3 id="依赖传递"><a class="markdownIt-Anchor" href="#依赖传递"></a> 依赖传递</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/09/19/JRhEjGUtq8aByp3.png" alt="依赖传递" /></p><p>依赖具有传递性</p><ul><li>直接依赖：在当前项目中通过依赖配置建立的依赖关系</li><li>间接依赖：被依赖的资源如果依赖其他资源，当前项目间接依赖其他资源</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/09/19/dAI5ueLH1jZUwXa.png" alt="排除依赖" /></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">depencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">depencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里将Spring Boot测试启动器<code>spring-boot-starter-test</code>添加到项目的依赖项中，并在该依赖项中排除Junit Vintage引擎依赖项<code>junit-vintage-engine</code>，以便使用其他测试框架，其中<code>scope</code>的含义见<strong>依赖范围</strong>。</p><h3 id="依赖范围"><a class="markdownIt-Anchor" href="#依赖范围"></a> 依赖范围</h3><p><code>scope</code>参数含义：</p><ul><li><code>compile</code>：参与程序的运行、测试及打包，留空时默认为compile</li><li><code>test</code>：只在测试程序范围有效，不参与主程序和打包</li><li><code>provided</code>：不参与打包</li><li><code>runtime</code>：不参与主程序</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/09/19/v6JoRNS2pIqAzMh.png" alt="依赖作用范围" /></p><h3 id="生命周期"><a class="markdownIt-Anchor" href="#生命周期"></a> 生命周期</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/09/19/vq3QwFJ9IyEKp1A.png" alt="三套生命周期" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/09/19/reENSADGMtYcQ9q.png" alt="各生命周期阶段" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/09/19/hlcmGf9vaBu1ObD.png" alt="生命周期阶段" /></p><blockquote><p>当点击<code>install</code>时，maven会自动运行 <code>compile、test、package、install</code> 整个阶段。</p></blockquote>]]></content>
    
    
    <summary type="html">记录学习JavaWeb课程中的部分知识点，包括maven依赖管理、maven高阶、Mybatis、SpringBoot自动配置等。</summary>
    
    
    
    <category term="JavaWeb" scheme="https://www.kzmqvq.com/categories/JavaWeb/"/>
    
    
    <category term="JavaWeb" scheme="https://www.kzmqvq.com/tags/JavaWeb/"/>
    
    <category term="后端" scheme="https://www.kzmqvq.com/tags/%E5%90%8E%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】ChatGPT提示词指南</title>
    <link href="https://www.kzmqvq.com/posts/66c40c65.html"/>
    <id>https://www.kzmqvq.com/posts/66c40c65.html</id>
    <published>2023-07-05T05:30:08.000Z</published>
    <updated>2023-07-09T12:43:27.436Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>本篇博客搜罗了个人遇到的有用方法和文档，希望能帮助各位更好地调教GPT。</p><h2 id="提示词文档"><a class="markdownIt-Anchor" href="#提示词文档"></a> 提示词文档</h2><div class="note success flat"><p>一份现成的文档，直接复制粘贴到对话窗口，GPT就会自动向你提问，索取需要的提示词。</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/07/05/6z3XknmKP4sr9lL.jpg" alt="主动提问的GPT" /></p><p>你是一个专家级ChatGPT提示工程师，在各种主题方面具有专业知识。在我们的互动过程中，你会称我为(你的名字)。让我们合作创建最好的ChatGPT，响应我提供的提示。我们将进行如下交互：</p><ol><li><p>我会告诉你如何帮助我。</p></li><li><p>根据我的要求，您将建议您应该承担的其他专家角色，除了成为专家级ChatGPT提示工程师之外，以提供最佳响应。然后，您将询问是否应继续执行建议的角色，或修改它们以获得最佳结果。</p></li><li><p>如果我同意，您将采用所有其他专家角色，包括最初的Expert ChatGPT Prompt Engineer角色</p></li><li><p>如果我不同意，您将询问应删除哪些角色，消除这些角色，并保留剩余的角色，包括专家级ChatGPT Prompt工程师角色，然后再继续。</p></li><li><p>您将确认您的活动专家角色，概述每个角色下的技能，并询问我是否要修改任何角色。</p></li><li><p>如果我同意，您将询问要添加或删除哪些角色，我将通知您。重复步骤5，直到我对角色满意为止。</p></li><li><p>如果我不同意，请继续下一步。</p></li><li><p>你会问：“我怎样才能帮助【我对步骤1的回答】?”</p></li><li><p>我会给出我的答案</p></li><li><p>你会问我是否想使用任何参考来源来制作完美的提示</p></li><li><p>如果我同意，你会问我想使用的来源数量。</p></li><li><p>您将单独请求每个来源，在您查看完后确认，并要求下一个。继续，直到您查看了所有源，然后移动到下一一步。</p></li><li><p>您将以列表格式请求有关我的原始提示的更多细节，以充分了解我的期望。</p></li><li><p>我会回答你的问题。</p></li><li><p>从这一点开始，您将在所有确认的专家角色下操作，并使用我的原始提示和步骤14中的其他细节创建详细的ChatGPT提示。提出新的提示并征求我的反馈。</p></li><li><p>如果我满意，您将描述每个专家角色的贡献以及他们将如何协作以产生全面的结果。然后，询问是否缺少任何输出或专家。</p><ol><li><p>如果我同意，我将指出缺少的角色或输出，您将在重复步骤15之前调整角色。</p></li><li><p>如果我不同意，您将作为所有已确认的专家角色执行提供的提示，并生成步骤15中概述的输出。继续执行步聚20。</p></li></ol></li><li><p>如果我不满意，你会问具体问题的提示</p></li><li><p>我将提供补充资料。</p></li><li><p>按照步聚15中的流程生成新提示，并考虑我在步聚18中的反馈。</p></li><li><p>完成回复后，询问我是否需要任何更改。</p></li><li><p>如果我同意，请请求所需的更改，参考您之前的回复，进行所需的调整，并生成新的提示。重复步骤15-20，直到我对提示符满意为止。如果你完全理解你的任务，回答：我今天能帮你什么，靓仔？</p></li></ol><h2 id="总结b站视频内容工具"><a class="markdownIt-Anchor" href="#总结b站视频内容工具"></a> 总结B站视频内容工具</h2><div class="note success flat"><p>一键总结你感兴趣的视频内容，节约时间和流量🤣</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/07/05/S9nTW3zP8JBLxk2.png" alt="BibiGPT AI学习助理" /></p><div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=352747000&bvid=BV1fX4y1Q7Ux&cid=1029248276&page=1&autoplay=false"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     high_quality=1    danmaku=1     allowfullscreen="true">     </iframe></div><h3 id="摘要"><a class="markdownIt-Anchor" href="#摘要"></a> 摘要</h3><p>【BiliGPT】AI自动总结B站视频内容，ChatGPT API智能提取并总结字幕。该应用可以通过将哔哩哔哩的URL粘贴进去并点击一键总结，自动提取和总结视频内容。</p><h3 id="亮点"><a class="markdownIt-Anchor" href="#亮点"></a> 亮点</h3><ul><li><p>🤖 BiliGPT是一个使用ChatGPT API开发的应用，可以自动一键总结哔哩哔哩视频的内容。</p></li><li><p>📚 应用可以从视频的字幕中精确提取出主要内容、谬论发现、学习新单词等方面。</p></li><li><p>🎥 可以通过将视频链接中的&quot;.com&quot;替换为&quot;.jimmylv.cn&quot;，快速跳转到一键总结页面。</p></li><li><p>📝 应用还支持总结微信聊天记录等内容，将关键词提取导入到Notion，并提供中文翻译。</p></li><li><p>💰 使用OpenAI的API需要花费一定费用，但应用也支持用户使用自己的API Key。</p><ul><li>添加自己的API Key后，数据只会存储在本地，保护用户的数据安全。</li><li>欢迎用户支持作者，通过扫码给作者打赏。</li></ul></li><li><p>📲 应用还提供移动端快捷指令，方便在移动设备上使用。</p><ul><li>可以通过分享视频，并选择快捷指令来进行一键总结。</li><li>使用体验流畅，支持横屏视频播放。</li></ul></li></ul><div class="tag link"><a class="link-card" title="BibiGPT跳转链接" href="https://b.jimmylv.cn/"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">BibiGPT跳转链接</p><p class="url">https://b.jimmylv.cn/</p></div></a></div> <h2 id="工具助手扮演"><a class="markdownIt-Anchor" href="#工具助手扮演"></a> 工具助手扮演</h2><div class="note success flat"><p>Github上一个 82.6k 的开源项目，帮助你调试GPT为合适的角色。</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/07/05/Gspt6UkO5qYcSdJ.png" alt="awesome-chatgpt-prompts" /></p><h3 id="linux终端"><a class="markdownIt-Anchor" href="#linux终端"></a> Linux终端</h3><div class="note info flat"><p>我想让你扮演一个linux终端。我将键入命令，您将回复终端应该显示的内容。我希望您只回复一个唯一代码块内的终端输出，而不是其他任何内容。不要写解释。不要键入命令，除非我指示你这样做。当我需要用英语告诉你一些事情时，我会把文本放在大括号里，像这样 {} 。我的第一个命令是pwd</p></div><h3 id="辩手"><a class="markdownIt-Anchor" href="#辩手"></a> 辩手</h3><div class="note info flat"><p>我希望你扮演辩手的角色。我将为你提供一些与时事相关的话题，你的任务是研究辩论双方，为每一方提出有效的论据，反驳相反的观点，并根据证据得出有说服力的结论。您的目标是帮助人们从讨论中解脱出来，增加对当前主题的了解和洞察力。我的第一个请求是“我想要一篇关于 Deno 的评论。”</p></div><h3 id="小说家"><a class="markdownIt-Anchor" href="#小说家"></a> 小说家</h3><div class="note info flat"><p>我希望你扮演一名小说家。您将想出富有创意且引人入胜的故事，可以长时间吸引读者。你可以选择任何类型，如奇幻、浪漫、历史小说等，但目标是写出具有出色情节、引人入胜的人物和意想不到的高潮的作品。我的第一个要求是“我要写一部以未来为背景的科幻小说”。</p></div><h3 id="影评人"><a class="markdownIt-Anchor" href="#影评人"></a> 影评人</h3><div class="note info flat"><p>我希望你担任影评人。您将撰写一篇引人入胜且富有创意的电影评论。你可以涵盖情节、主题和基调、表演和角色、导演、配乐、摄影、制作设计、特效、编辑、节奏、对话等主题。但最重要的方面是强调这部电影给你带来的感受。什么真正引起了你的共鸣。您也可以批评这部电影。请避免剧透。我的第一个要求是“我需要为电影《星际穿越》写一篇影评”</p></div><p>更多内容详见官网。</p><div class="tag link"><a class="link-card" title="Awesome ChatGPT Prompts" href="https://prompts.chat"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Awesome ChatGPT Prompts</p><p class="url">https://prompts.chat</p></div></a></div><div class="tag link"><a class="link-card" title="Github项目地址" href="https://github.com/f/awesome-chatgpt-prompts"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">Github项目地址</p><p class="url">https://github.com/f/awesome-chatgpt-prompts</p></div></a></div>]]></content>
    
    
    <summary type="html">记录ChatGPT的提示方法</summary>
    
    
    
    <category term="实用工具" scheme="https://www.kzmqvq.com/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="小工具" scheme="https://www.kzmqvq.com/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/"/>
    
    <category term="Tools" scheme="https://www.kzmqvq.com/tags/Tools/"/>
    
    <category term="ChatGPT" scheme="https://www.kzmqvq.com/tags/ChatGPT/"/>
    
  </entry>
  
  <entry>
    <title>【客说闲谈】学历对打工人的意义</title>
    <link href="https://www.kzmqvq.com/posts/1b531470.html"/>
    <id>https://www.kzmqvq.com/posts/1b531470.html</id>
    <published>2023-02-09T03:25:38.000Z</published>
    <updated>2024-02-22T09:18:23.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>本篇博客内容来源于b站视频——<a href="https://www.bilibili.com/video/BV1GM411a7D2">“学历对打工人的意义？这是我听过最通透的答案”</a>，up主–<a href="https://space.bilibili.com/346749212">wrizedm</a>。希望能对即将毕业的大学生一些启迪。谁的青春不迷茫，纵使身后没有灯火，身前白雾茫茫，也要做自己的 太阳！</p><h2 id="视频链接"><a class="markdownIt-Anchor" href="#视频链接"></a> 视频链接</h2><div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=522271124&&page=1&as_wide=1&high_quality=1&danmaku=0&autoplay=false"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     high_quality=1    danmaku=1     allowfullscreen="true">     </iframe></div><h2 id="内容"><a class="markdownIt-Anchor" href="#内容"></a> 内容</h2><div class="note success flat"><p>学历相当于敲门砖，可能有时候学历并不重要，但是大多时候，学历挺重要的。好的生活是奋斗来的，人在有学历后还是要不断上进的！</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/09/ipnFf4CORBqUsM3.jpg" alt="1" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/09/ij9qabrhQD48yNP.jpg" alt="2" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/09/9Ver5gQ2F6vR3BL.jpg" alt="3" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/09/GDHXfy82vI1Yndw.jpg" alt="4" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/09/xGRS6LjhUCaZiN1.png" alt="5" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/09/g9rXe68THuADPkM.jpg" alt="6" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/09/ekpy5XG6TQIRuio.jpg" alt="7" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/09/XPa3SToxwuFyizm.jpg" alt="9" /></p><div class="note info flat"><p>从来没有天道酬勤，只有更努力更幸运！🌈</p></div>]]></content>
    
    
    <summary type="html">学历对打工人的意义？这是我听过最通透的答案。</summary>
    
    
    
    <category term="客说闲谈" scheme="https://www.kzmqvq.com/categories/%E5%AE%A2%E8%AF%B4%E9%97%B2%E8%B0%88/"/>
    
    
    <category term="客说闲谈" scheme="https://www.kzmqvq.com/tags/%E5%AE%A2%E8%AF%B4%E9%97%B2%E8%B0%88/"/>
    
    <category term="学历" scheme="https://www.kzmqvq.com/tags/%E5%AD%A6%E5%8E%86/"/>
    
    <category term="打工人" scheme="https://www.kzmqvq.com/tags/%E6%89%93%E5%B7%A5%E4%BA%BA/"/>
    
    <category term="客怎眠qvq" scheme="https://www.kzmqvq.com/tags/%E5%AE%A2%E6%80%8E%E7%9C%A0qvq/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】微信小程序入坑指南</title>
    <link href="https://www.kzmqvq.com/posts/4adda35c.html"/>
    <id>https://www.kzmqvq.com/posts/4adda35c.html</id>
    <published>2023-02-09T03:24:45.000Z</published>
    <updated>2023-03-05T14:15:32.384Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>本篇文章记录了学习微信小程序时遇到的一些问题和知识点，学习材料是<a href="https://github.com/coderwhy">coderwhy</a>老师的视频。</p><h2 id="本地开发环境设定与修改"><a class="markdownIt-Anchor" href="#本地开发环境设定与修改"></a> 本地开发环境设定与修改</h2><p>微信开发者工具将个人对工具做的所有配置都写入到了<code>project.config.json</code>文件中，当更换电脑或重装时，只需要载入同一个项目的代码包，开发者工具就自动会帮开发者恢复到当时开发项目时的个性化配置，其中会包括编辑器的颜色、代码上传时自动压缩等等一系列选项。</p><p>需要注意<code>project.config.json</code> 和 <code>project.private.config.json</code>两个文件的区别，<code>private</code>是个人的配置且优先级更高，以下来源于微信开发文档：</p><ol><li>项目根目录中的 <code>project.config.json</code> 和 <code>project.private.config.json</code> 文件可以对项目进行配置，</li><li><code>project.private.config.json</code> 中的相同设置优先级高于 <code>project.config.json</code></li><li>可以在 <code>project.config.json</code> 文件中配置公共的配置，在 <code>project.private.config.json</code> 配置个人的配置，可以将 <code>project.private.config.json</code> 写到 <code>.gitignore</code> 避免版本管理的冲突。</li><li><code>project.private.config.json</code> 中有的字段，开发者工具内的设置修改会优先覆盖 <code>project.private.config.json</code> 的内容。如在 <code>project.private.config.json</code> 有 <code>appid</code> 字段，那么在 详情 - 基本信息 中修改了 appid，会写到 <code>project.private.config.json</code> 中，不会覆盖掉 <code>project.config.json</code> 的 <code>appid</code> 字段的内容</li><li>开发阶段相关的设置修改优先同步到 <code>project.private.config.json</code> 中，但与最终编译产物有关的设置无法在 <code>project.private.config.json</code> 中生效，界面上的改动也不会同步到 <code>project.private.config.json</code> 文件中。详见 <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#setting">表格</a>是否允许私有设置。</li></ol><p>当需要更换版本、修改本地调试的设置时，打开开发工具右上角的详情，修改本地设置即可。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/23/ZgnCk8Aac71LdFz.png" alt="01-本地config配置" /></p><h2 id="页面下拉刷新与上拉加载"><a class="markdownIt-Anchor" href="#页面下拉刷新与上拉加载"></a> 页面下拉刷新与上拉加载</h2><p>针对单个页面（page）实现下拉刷新和上拉加载，需要用到<code>onPullDownRefresh</code>和<code>onReachBottom</code>两个函数，对需要实现的页面配置<code>page.js</code>，样例代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/profile/profile.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">avatarURL</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">listCount</span>: <span class="number">30</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里针对的是展示数据较多的页面，初始刷新，下拉onPullDownRefresh返回30条数据</span></span><br><span class="line">  <span class="comment">// 当用户浏览至底部后，触发onReachBottom返回额外的30条数据</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 监听下拉刷新</span></span><br><span class="line">  <span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;用户进行下拉刷新~&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟网络请求: 定时器</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">listCount</span>: <span class="number">30</span> &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// API: 停止下拉刷新</span></span><br><span class="line">      wx.<span class="title function_">stopPullDownRefresh</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;成功停止了下拉刷新&quot;</span>, res);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;失败停止了下拉刷新&quot;</span>, err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听页面滚动到底部</span></span><br><span class="line">  <span class="title function_">onReachBottom</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onReachBottom&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">listCount</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">listCount</span> + <span class="number">30</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;listCount&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>列表数据:&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/24/OShp1f3XH5aGAu9.png" alt="02-下拉刷新" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/24/QhAEwsizdZqOB87.png" alt="03-下拉刷新" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/24/4xMP51XO9EWds6q.png" alt="04-上拉刷新" /></p><h2 id="小程序进入场景场景值"><a class="markdownIt-Anchor" href="#小程序进入场景场景值"></a> 小程序进入场景（场景值）</h2><p>场景值用来描述用户进入小程序的路径。通俗地说，就是你从哪找到这个小程序的，小程序可以获取到这个值，针对不同的业务场景（场景值），进行相应的处理，以实现更为细致的业务逻辑。相关操作在项目根目录下的<code>app.js</code>中进行，使用<code>onLaunch、onShow</code>函数或者<code>wx.getLaunchOptionSync</code>获取。</p><p>个人感觉就像是两个不认识的人——用户A、小程序C，他们都认识小程序B，有一天用户A收到小程序B的推荐认识了小程序C，小程序C为了和用户A相处的更加自然，从小程序B处获取用户A的相关信息。</p><h2 id="全局共享数据"><a class="markdownIt-Anchor" href="#全局共享数据"></a> 全局共享数据</h2><p>通过配置根目录的<code>app.js</code>设置全局的数据<code>globalData</code>，在页面中使用<code>getApp()</code>获取</p><div class="note info flat"><p>数据不是响应式，共享的数据通常是一些固定的数据</p></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/order/order.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取共享的数据: App实例中数据</span></span><br><span class="line">    <span class="comment">// 1.获取app实例对象</span></span><br><span class="line">    <span class="keyword">const</span> app = <span class="title function_">getApp</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.从app实例对象获取数据</span></span><br><span class="line">    <span class="keyword">const</span> token = app.<span class="property">globalData</span>.<span class="property">token</span></span><br><span class="line">    <span class="keyword">const</span> userInfo = app.<span class="property">globalData</span>.<span class="property">userInfo</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(token, userInfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.拿到token目的发送网络请求</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4.将数据展示到界面上面</span></span><br><span class="line">    <span class="comment">// this.data.userInfo = userInfo</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; userInfo &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">userInfo</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="登录基本逻辑appjs"><a class="markdownIt-Anchor" href="#登录基本逻辑appjs"></a> 登录基本逻辑（app.js）</h2><p><code>App</code>框架接口示例代码，由于登录过程比较复杂，这里只做简单说明。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">App</span>(&#123;</span><br><span class="line">  <span class="attr">globalData</span>: &#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  onLaunch (options) &#123;</span><br><span class="line">    <span class="comment">// Do something initial when launch.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 0.从本地获取token/userInfo</span></span><br><span class="line">    <span class="keyword">const</span> token = wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    <span class="keyword">const</span> userInfo = wx.<span class="title function_">getStorageSync</span>(<span class="string">&quot;userInfo&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.进行登录操作(判断逻辑)</span></span><br><span class="line">    <span class="keyword">if</span> (!token || !userInfo) &#123;</span><br><span class="line">      <span class="comment">// 将登录成功的数据, 保存到storage</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;登录操作&quot;</span>);</span><br><span class="line">      wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;kobetoken&quot;</span>)</span><br><span class="line">      wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;userInfo&quot;</span>, &#123; <span class="attr">nickname</span>: <span class="string">&quot;kobe&quot;</span>, <span class="attr">level</span>: <span class="number">100</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.将获取到数据保存到globalData中</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">token</span> = token</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">userInfo</span> = userInfo</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.发送网络请求, 优先请求一些必要的数据</span></span><br><span class="line">    <span class="comment">// wx.request(&#123; url: &#x27;url&#x27;&#125;)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onShow (options) &#123;</span><br><span class="line">    <span class="comment">// Do something when show.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onHide () &#123;</span><br><span class="line">    <span class="comment">// Do something when hide.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onError (msg) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(msg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="按钮跳转处理逻辑"><a class="markdownIt-Anchor" href="#按钮跳转处理逻辑"></a> 按钮跳转处理逻辑</h2><p>在首页使用<code>wx:for=&quot;&#123;&#123;pages&#125;&#125;&quot;</code>的方式将各个子页面的跳转以按钮的形式呈现出来，方便查看各知识点。</p><div class="note info flat"><p><code>data-xx</code>的使用，后续的传参必须是存在的、可使用的值，<code>xx</code>是个人自定义的名字。</p></div><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home首页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;pages&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;pages&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- item是index.js中已定义的值，data-item是个人自定义的名字，data-name、data-id都可以 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">bindtap</span>=<span class="string">&quot;onBtnClick&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-item</span>=<span class="string">&quot;&#123;&#123;item&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      &#123;&#123; item.name &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="comment">// path中的 02 是一条错误示范</span></span><br><span class="line">    <span class="attr">pages</span>: [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;01_初体验&quot;</span>, <span class="attr">path</span>: <span class="string">&quot;/pages/01test/index&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;02_页面配置&quot;</span>, <span class="attr">path</span>: <span class="string">&quot;pages/02_页面配置/index&quot;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onBtnClick</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="comment">// 1.获取item</span></span><br><span class="line">    <span class="keyword">const</span> item = event.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">item</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.跳转路径</span></span><br><span class="line">    wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: item.<span class="property">path</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note danger flat"><p><code>path</code>中不能使用中文，不能使用中文，不能使用中文！以<code>/</code>开头指明路径从根目录开始！</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/24/NH1nRXcoOIZgVUd.png" alt="05-path规范" /></p><div class="tag link"><a class="link-card" title="微信小程序data-xx的使用" href="https://blog.csdn.net/qq_33210042/article/details/91983464"><div class="left"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/link.png"/></div><div class="right"><p class="text">微信小程序data-xx的使用</p><p class="url">https://blog.csdn.net/qq_33210042/article/details/91983464</p></div></a></div> <h2 id="注册加载页面page"><a class="markdownIt-Anchor" href="#注册加载页面page"></a> 注册加载页面（page）</h2><blockquote><p>不要把开发工具固定在任务栏，会造成启动调试器不成功</p></blockquote><p>单个页面（page）的<code>js</code>文件用于发送网络请求、获取数据、同时定义本地固定的数据、绑定页面产生事件的回调函数和刷新滚动操作。<code>onLoad</code>函数在页面加载时发送请求。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">banners</span>: [],</span><br><span class="line">    <span class="attr">recommends</span>: [],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.作用二: 定义本地固定的数据</span></span><br><span class="line">    <span class="attr">counter</span>: <span class="number">100</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">btns</span>: [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;orange&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 1.作用一: 发送网络请求, 请求数据</span></span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onLoad&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送网络请求</span></span><br><span class="line">    wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = res.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">        <span class="keyword">const</span> banners = data.<span class="property">banner</span>.<span class="property">list</span></span><br><span class="line">        <span class="keyword">const</span> recommends = data.<span class="property">recommend</span>.<span class="property">list</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; banners, recommends &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.绑定wxml中产生事件后的回调函数</span></span><br><span class="line">  <span class="title function_">onBtn1Click</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onBtn1Click&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onBtnClick</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;btn click:&quot;</span>, event.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">color</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.绑定下拉刷新/达到底部/页面滚动</span></span><br><span class="line">  <span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onPullDownRefresh&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onReachBottom</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onReachBottom&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onPageScroll</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onPageScroll:&quot;</span>, event);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生命周期函数: </span></span><br><span class="line">  <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onShow&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onReady&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onHide</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onHide&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onUnload&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/24/mykKIF4baBdlw2x.png" alt="06-轮播图" /></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;banner&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">circular</span> <span class="attr">autoplay</span> <span class="attr">indicator-dots</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;banners&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;acm&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- image组件默认宽度和高度: 320x240 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.image&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="常用组件"><a class="markdownIt-Anchor" href="#常用组件"></a> 常用组件</h2><h3 id="text"><a class="markdownIt-Anchor" href="#text"></a> text</h3><p>文本组件。其中的<code>user-select</code>参数控制文本是否可选；<code>decode</code>参数控制是否解码，如表示空格的<code>&amp;nbsp</code>、<code>&amp;ensp</code>、<code>&amp;emsp</code>；<code>selectable</code>参数控制可选的方案现已废弃。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">text</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">user-select</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">user-select</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">decode</span>&gt;</span><span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/27/Id3lyCTBeMFrPa1.png" alt="08-text组件" /></p><h3 id="button"><a class="markdownIt-Anchor" href="#button"></a> button</h3><p>与<code>element</code>组件类似，提供了各种参数控制按钮的样式和功能。其中<code>type</code>参数控制按钮的样式，<code>size</code>参数控制按钮的大小，在开发过程中会经常性地使用<code>open-type</code>参数，满足信息获取的需求。这里需要掌握<code>getUserInfo</code>的处理方式。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 获取用户信息 1 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 从 bindgetuserinfo 回调中获取到用户信息 open-type=&quot;getUserInfo&quot;时有效 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">open-type</span>=<span class="string">&quot;getUserInfo&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">bindgetuserinfo</span>=<span class="string">&quot;getUserInfo&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  用户信息1</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 获取用户信息 2 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在组件中绑定一个事件处理函数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;getUserInfo&quot;</span>&gt;</span>用户信息2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">  <span class="title function_">getUserInfo</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="comment">// 调用API, 获取用户的信息</span></span><br><span class="line">    <span class="comment">// 1.早期小程序的API, 基本都是不支持Promise风格</span></span><br><span class="line">    <span class="comment">// 2.后期小程序的API, 基本都开发支持Promise风格</span></span><br><span class="line">    wx.<span class="title function_">getUserProfile</span>(&#123;</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&#x27;desc&#x27;</span>,</span><br><span class="line">      <span class="comment">// success: (res) =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//   console.log(res);</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><div class="note info flat"><p><code>wx.getUserInfo</code>接口已被回收，换成<code>wx.getUserProfile</code>获取用户个人信息。</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/27/gh6jI7LwidRqo8Z.png" alt="11-getUserInfo接口失效" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/02/27/jgzeJpq2vGrBkYP.png" alt="12-getUserInfo" /></p><h3 id="view"><a class="markdownIt-Anchor" href="#view"></a> view</h3><p>较为简单，同样可以绑定点击事件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;onViewClick&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>我是view组件<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  ...,</span><br><span class="line">  <span class="title function_">onViewClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onViewClick&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="image"><a class="markdownIt-Anchor" href="#image"></a> image</h3><p><code>mode</code>作为参数控制，图片裁剪、缩放的模式。常用的有：<code>scaleToFill</code>无脑拉伸图片使其铺满元素；<code>aspectFit</code>保持纵横比例缩放图片，较为完整；<code>widthFix</code>宽度不变，高度按原图宽高比自动变化，推荐。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;https://vip2.loli.io/2023/01/25/AxZqRfM1h4TjG2B.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;aspectFit&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;https://vip2.loli.io/2023/01/25/AxZqRfM1h4TjG2B.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;https://vip2.loli.io/2023/01/25/AxZqRfM1h4TjG2B.png&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;heightFix&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><strong>图片可以和按钮结合，将用户本地的图片展示出来</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;onChooseImage&quot;</span>&gt;</span>选择图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;img&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;chooseImageUrl&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/02_common_cpns/index.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">chooseImageUrl</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...,</span><br><span class="line">  <span class="title function_">onChooseImage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    wx.<span class="title function_">chooseMedia</span>(&#123;</span><br><span class="line">      <span class="attr">mediaType</span>: <span class="string">&quot;image&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> imagePath = res.<span class="property">tempFiles</span>[<span class="number">0</span>].<span class="property">tempFilePath</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">chooseImageUrl</span>: imagePath &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="scroll-view"><a class="markdownIt-Anchor" href="#scroll-view"></a> scroll-view</h3><p>视图容器，规定某个固定高度或宽度的盒子，是通过左右滑动的方式查看内容还是通过上下滑动的方式查看内容。需要注意在对应的<code>wxss</code>文件规定<code>flex</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 上下滚动(y轴) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;viewColors&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: &#123;&#123;item&#125;&#125;;&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 左右滚动(x轴) 允许元素flex 实现多个view在一行 左右滑动查看--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;container scroll-x&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">scroll-x</span></span></span><br><span class="line"><span class="tag">  <span class="attr">enable-flex</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;viewColors&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: &#123;&#123;item&#125;&#125;;&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 监听事件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;container scroll-x&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">scroll-x</span></span></span><br><span class="line"><span class="tag">  <span class="attr">enable-flex</span></span></span><br><span class="line"><span class="tag">  <span class="attr">bindscrolltoupper</span>=<span class="string">&quot;onScrollToUpper&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">bindscrolltolower</span>=<span class="string">&quot;onScrollToLower&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">bindscroll</span>=<span class="string">&quot;onScroll&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;viewColors&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: &#123;&#123;item&#125;&#125;;&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/03/02/NZvgxYaf4UVKwLS.png" alt="15-scroll-view滚动" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/03/02/ulUweG65MWJcfYX.png" alt="16-scroll-view监听事件" /></p><h3 id="input"><a class="markdownIt-Anchor" href="#input"></a> input</h3><p>注意和vue的<code>v-bind</code>双向绑定的区别。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123;&#123;message&#125;&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&quot;Hello, World&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/03/05/Yw4rCSJZ5vapOsm.png" alt="17-input组件" /></p><h2 id="页面样式"><a class="markdownIt-Anchor" href="#页面样式"></a> 页面样式</h2><p>微信小程序的界面样式写法有三种：行内样式、页面样式、全局样式。优先级依次是 行内样式 &gt; 页面样式 &gt; 全局样式。这些都和<code>css</code>类似，不再赘述。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/03/05/h75qtWgNUme8rTM.png" alt="19-wxss支持的选择器" /></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.1.应用全局样式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在项目根目录下的 app.wxss 文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>learn wxss title<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 1.2.页面中的样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;message&quot;</span>&gt;</span>learn wxss message<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 1.3.行内的样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;color: blue;&quot;</span>&gt;</span>inline style<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 单个页面的 index.wxss */</span></span><br><span class="line"><span class="selector-class">.message</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 根目录 app.wxss */</span></span><br><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意的是小程序的页面尺寸单位<code>rpx</code>（区别于<code>css</code>的<code>rem</code>）。为了页面根据屏幕宽度进行自适应，规定屏幕宽为 750rpx，如在 iPhone6 上，屏幕宽度为 375 px，共有750个物理像素，则 750 rpx  =  375 px  = 750 物理像素，1rpx = 0.5px = 1物理像素。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/03/05/PA76k9eucblKOGL.png" alt="18-页面样式尺寸单位" /></p>]]></content>
    
    
    <summary type="html">记录学习微信小程序的笔记。</summary>
    
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/categories/Web/"/>
    
    <category term="微信小程序" scheme="https://www.kzmqvq.com/categories/Web/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
    <category term="微信小程序" scheme="https://www.kzmqvq.com/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>【客说闲谈】川普给美国年轻人的建议：不畏流言，勇敢逐梦</title>
    <link href="https://www.kzmqvq.com/posts/9d6fbd99.html"/>
    <id>https://www.kzmqvq.com/posts/9d6fbd99.html</id>
    <published>2023-01-31T10:08:15.000Z</published>
    <updated>2023-07-09T12:46:36.342Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>本篇博客内容来源于b站视频——<a href="https://www.bilibili.com/video/BV14e411c7SN">川普给美国年轻人的建议：从菜鸟开始, 不惧犯错，不畏流言，勇敢去追逐自己热爱的事情！</a>，抛开政治不谈，感觉说的很有道理，于是结合个人理解把翻译搬运了过来。愿各位不负韶华，饱含一腔热忱，永远年轻，永远热泪盈眶。</p><h2 id="视频链接"><a class="markdownIt-Anchor" href="#视频链接"></a> 视频链接</h2><div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=264080926&&page=1&as_wide=1&high_quality=1&danmaku=0&autoplay=false"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     high_quality=1    danmaku=1     allowfullscreen="true">     </iframe></div>## 内容<blockquote><p>Relish the opportunity to be an outsider.<br />珍惜做“门外汉”的机会</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/01/31/7BeEKp9fW4Ia1rD.jpg" alt="20230131182513" /></p><blockquote><p>Embrace that label.<br />拥抱这个标签</p></blockquote><blockquote><p>Being an outsider is fine, embrace the label.<br />是个“门外汉”没关系, 拥抱这个标签(享受这个标签)</p></blockquote><blockquote><p>Because it’s the outsiders who change the world and who make a real and lasting difference<br />因为是“门外汉们”改变了世界，给世界带来了真正且持续的改变</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/01/31/7dPaEhLUxcMso1f.jpg" alt="20230131182904" /></p><blockquote><p>And always have the courage to be yourself<br />同时 要一直持有做自己的那份勇气</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/01/31/Sn5cPz3WBj1qb2r.jpg" alt="20230131183415" /></p><blockquote><p>Most importantly，you have to do what you love<br />最重要的一点是, 一定要做你热爱的事</p></blockquote><blockquote><p>I have seen so many people<br />我见过很多的人</p></blockquote><blockquote><p>They’re forced through lots of reasons<br />他们被各种原因裹挟着</p></blockquote><blockquote><p>sometimes including family<br />有时还包括家庭的裹挟</p></blockquote><blockquote><p>to go down a path that they don’t want to go down<br />去走一条他们自己不想走的路</p></blockquote><blockquote><p>To go down a path that leads them to something that they don’t love<br />去走一条把他们引向了自己并不热爱的东西的路</p></blockquote><blockquote><p>that they don’t enjoy<br />他们并不觉得开心</p></blockquote><blockquote><p>You have to do what you love<br />你一定要做自己热爱的事情</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/01/31/MhlIa587qYbfOVs.jpg" alt="20230131184755" /></p><blockquote><p>Or you most likely won’t be very successful at it<br />否则你很可能 不会有什么出息</p></blockquote><blockquote><p>Never stop fighting for what you believe in and for the people who care about you<br />为了你的信仰和那些关心你的人，永不停歇地去奋斗（十年饮冰，热血难凉）</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/01/31/OGUAMJIXlmP8xCv.jpg" alt="20230131183552" /></p><blockquote><p>Carry yourself with dignity and pride<br />保持自己的尊严和骄傲（我有我的自尊和我的骄傲）</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/01/31/SP5siG1EpmHk8RN.jpg" alt="20230131183654" /></p><blockquote><p>Remember this.<br />记住这点</p></blockquote><blockquote><p>Nothing worth doing ever, ever, ever came easy<br />任何值得做的事情，从来不会轻易实现</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/01/31/hUgx3sKaYPMSifn.jpg" alt="20230131184017" /></p><blockquote><p>Following your convictions means you must be willing to face criticism for those who lack the same courage to do what is right<br />追随你的信念 这意味着你必须直面 那些没有相同勇气做正确事情的人们对你的批评</p></blockquote><blockquote><p>and they know what is right<br />而且他们明明知道 什么是正确的</p></blockquote><div class="note danger flat"><p>But they don’t have the courage or the guts or the stamina to take it and to do it<br />但是他们没有勇气 没有胆量 也没有毅力 去承担做正确事情的风险和责任</p></div><div class="note success flat"><p>It’s called The Road Less Traveled.<br />你要入那窄门去，走那人迹罕至之路，因为真正的伟大总是鲜有人及  ——《圣经》</p></div><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2023/01/31/ZAGDb2IPn3TKf15.jpg" alt="20230131184110" /></p>]]></content>
    
    
    <summary type="html">川普给美国年轻人的建议：从菜鸟开始, 不惧犯错，不畏流言，勇敢去追逐自己热爱的事情！</summary>
    
    
    
    <category term="客说闲谈" scheme="https://www.kzmqvq.com/categories/%E5%AE%A2%E8%AF%B4%E9%97%B2%E8%B0%88/"/>
    
    
    <category term="客说闲谈" scheme="https://www.kzmqvq.com/tags/%E5%AE%A2%E8%AF%B4%E9%97%B2%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】数据类型</title>
    <link href="https://www.kzmqvq.com/posts/889c180f.html"/>
    <id>https://www.kzmqvq.com/posts/889c180f.html</id>
    <published>2022-09-19T14:26:59.000Z</published>
    <updated>2024-02-26T01:16:20.389Z</updated>
    
    <content type="html"><![CDATA[<h2 id="java数据类型"><a class="markdownIt-Anchor" href="#java数据类型"></a> JAVA数据类型</h2><p>Java基本数据类型共有八种。可以分为三类，字符类型<code>char</code>，布尔类型<code>boolean</code>以及数值类型<code>byte、short、int、long、float、double</code>。数值类型又可以分为整数类型byte、short、int、long和浮点数类型float、double。</p><p>JAVA中的数值类型不存在无符号的，它们的取值范围是固定的，不会随着机器硬件环境或者操作系统的改变而改变。实际上，JAVA中还存在另外一种基本类型void，它也有对应的包装类 java.lang.Void，不过我们无法直接对它们进行操作。8 中类型表示范围如下：</p><p><code>byte</code>：8位，最大存储数据量是255，存放的数据范围是-128~127之间。</p><p><code>short</code>：16位，最大数据存储量是65536，数据范围是-32768~32767之间。</p><p><code>int</code>：32位，最大数据存储容量是2的32次方减1，数据范围是负的2的31次方到正的2的31次方减1。</p><p><code>long</code>：64位，最大数据存储容量是2的64次方减1，数据范围为负的2的63次方到正的2的63次方减1。</p><p><code>float</code>：32位，数据范围在3.4e-45~1.4e38，直接赋值时必须在数字后加上f或F。</p><p><code>double</code>：64位，数据范围在4.9e-324~1.8e308，赋值时可以加d或D也可以不加。</p><p><code>boolean</code>：只有true和false两个取值。</p><p><code>char</code>：16位，存储Unicode码，用单引号赋值。</p><h2 id="javascript数据类型"><a class="markdownIt-Anchor" href="#javascript数据类型"></a> JavaScript数据类型</h2><p>JavaScript共有八种数据类型，分别是<code>Undefined、Null、Boolean、Number、String、Object、Symbol、BigInt</code>。</p><p>其中 Symbol 和 BigInt 是ES6 中新增的数据类型：</p><ul><li>Symbol 代表创建后独一无二且不可变的数据类型，它主要是为了解决可能出现的全局变量冲突的问题。</li><li>BigInt 是一种数字类型的数据，它可以表示任意精度格式的整数，使用 BigInt 可以安全地存储和操作大整数，即使这个数已经超出了 Number 能够表示的安全整数范围。</li></ul><p>这些数据可以分为原始数据类型和引用数据类型：</p><ul><li>栈：原始数据类型（Undefined、Null、Boolean、Number、String）</li><li>堆：引用数据类型（对象、数组和函数）</li></ul><p>两种类型的区别在于<strong>存储位置的不同：</strong></p><ul><li>原始数据类型直接存储在栈（stack）中的简单数据段，占据空间小、大小固定，属于被频繁使用数据，所以放入栈中存储；</li><li>引用数据类型存储在堆（heap）中的对象，占据空间大、大小不固定。如果存储在栈中，将会影响程序运行的性能；引用数据类型在栈中存储了指针，该指针指向堆中该实体的起始地址。当解释器寻找引用值时，会首先检索其在栈中的地址，取得地址后从堆中获得实体。</li></ul><p>堆和栈的概念存在于数据结构和操作系统内存中，在数据结构中：</p><ul><li>在数据结构中，栈中数据的存取方式为先进后出。</li><li>堆是一个优先队列，是按优先级来进行排序的，优先级可以按照大小来规定。</li></ul><p>在操作系统中，内存被分为栈区和堆区：</p><ul><li>栈区内存由编译器自动分配释放，存放函数的参数值，局部变量的值等。其操作方式类似于数据结构中的栈。</li><li>堆区内存一般由开发着分配释放，若开发者不释放，程序结束时可能由垃圾回收机制回收。</li></ul><h2 id="作用域与闭包"><a class="markdownIt-Anchor" href="#作用域与闭包"></a> 作用域与闭包</h2><h3 id="对闭包的理解"><a class="markdownIt-Anchor" href="#对闭包的理解"></a> 对闭包的理解</h3><p><strong>闭包是指有权访问另一个函数作用域中变量的函数</strong>，创建闭包的最常见的方式就是在一个函数内创建另一个函数，创建的函数可以访问到当前函数的局部变量。</p><p>闭包有两个常用的用途；</p><ul><li>闭包的第一个用途是使我们在函数外部能够访问到函数内部的变量。通过使用闭包，可以通过在外部调用闭包函数，从而在外部访问到函数内部的变量，可以使用这种方法来创建私有变量。</li><li>闭包的另一个用途是使已经运行结束的函数上下文中的变量对象继续留在内存中，因为闭包函数保留了这个变量对象的引用，所以这个变量对象不会被回收。</li></ul><p>比如，函数 A 内部有一个函数 B，函数 B 可以访问到函数 A 中的变量，那么函数 B 就是闭包。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function A() &#123;</span><br><span class="line">  let a = 1</span><br><span class="line">  window.B = function () &#123;</span><br><span class="line">      console.log(a)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">A()</span><br><span class="line">B() // 1</span><br></pre></td></tr></table></figure><p>在 JS 中，闭包存在的意义就是让我们可以间接访问函数内部的变量。经典面试题：循环中使用闭包解决 var 定义函数的问题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">  setTimeout(function timer() &#123;</span><br><span class="line">    console.log(i)</span><br><span class="line">  &#125;, i * 1000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先因为 <code>setTimeout</code> 是个异步函数，所以会先把循环全部执行完毕，这时候 <code>i</code> 就是 6 了，所以会输出一堆 6。解决办法有三种：</p><ul><li>第一种是使用闭包的方式</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">  ;(function(j) &#123;</span><br><span class="line">    setTimeout(function timer() &#123;</span><br><span class="line">      console.log(j)</span><br><span class="line">    &#125;, j * 1000)</span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上述代码中，首先使用了立即执行函数将 <code>i</code> 传入函数内部，这个时候值就被固定在了参数 <code>j</code> 上面不会改变，当下次执行 <code>timer</code> 这个闭包的时候，就可以使用外部函数的变量 <code>j</code>，从而达到目的。</p><ul><li>第二种就是使用 <code>setTimeout</code> 的第三个参数，这个参数会被当成 <code>timer</code> 函数的参数传入。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">  setTimeout(</span><br><span class="line">    function timer(j) &#123;</span><br><span class="line">      console.log(j)</span><br><span class="line">    &#125;,</span><br><span class="line">    i * 1000,</span><br><span class="line">    i</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>第三种就是使用 <code>let</code> 定义 <code>i</code> 了来解决问题了，这个也是最为推荐的方式</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (let i = 1; i &lt;= 5; i++) &#123;</span><br><span class="line">  setTimeout(function timer() &#123;</span><br><span class="line">    console.log(i)</span><br><span class="line">  &#125;, i * 1000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="对作用域-作用域链的理解"><a class="markdownIt-Anchor" href="#对作用域-作用域链的理解"></a> 对作用域、作用域链的理解</h3><h4 id="全局作用域和函数作用域"><a class="markdownIt-Anchor" href="#全局作用域和函数作用域"></a> 全局作用域和函数作用域</h4><p>（1）全局作用域</p><ul><li>最外层函数和最外层函数外面定义的变量拥有全局作用域</li><li>所有未定义直接赋值的变量自动声明为全局作用域</li><li>所有window对象的属性拥有全局作用域</li><li>全局作用域有很大的弊端，过多的全局作用域变量会污染全局命名空间，容易引起命名冲突。</li></ul><p>（2）函数作用域</p><ul><li>函数作用域声明在函数内部的变零，一般只有固定的代码片段可以访问到</li><li>作用域是分层的，内层作用域可以访问外层作用域，反之不行</li></ul><h4 id="块级作用域"><a class="markdownIt-Anchor" href="#块级作用域"></a> 块级作用域</h4><ul><li>使用ES6中新增的let和const指令可以声明块级作用域，块级作用域可以在函数中创建也可以在一个代码块中的创建（由<code>&#123; &#125;</code>包裹的代码片段）</li><li>let和const声明的变量不会有变量提升，也不可以重复声明</li><li>在循环中比较适合绑定块级作用域，这样就可以把声明的计数器变量限制在循环内部。</li></ul><h4 id="作用域链"><a class="markdownIt-Anchor" href="#作用域链"></a> 作用域链</h4><p>在当前作用域中查找所需变量，但是该作用域没有这个变量，那这个变量就是自由变量。如果在自己作用域找不到该变量就去父级作用域查找，依次向上级作用域查找，直到访问到window对象就被终止，这一层层的关系就是作用域链。</p><p>作用域链的作用是<strong>保证对执行环境有权访问的所有变量和函数的有序访问，通过作用域链，可以访问到外层环境的变量和函数。</strong></p><p>作用域链的本质上是一个指向变量对象的指针列表。变量对象是一个包含了执行环境中所有变量和函数的对象。作用域链的前端始终都是当前执行上下文的变量对象。全局执行上下文的变量对象（也就是全局对象）始终是作用域链的最后一个对象。</p><p>当查找一个变量时，如果当前执行环境中没有找到，可以沿着作用域链向后查找。</p><h3 id="对执行上下文的理解"><a class="markdownIt-Anchor" href="#对执行上下文的理解"></a> 对执行上下文的理解</h3><h4 id="1-执行上下文类型"><a class="markdownIt-Anchor" href="#1-执行上下文类型"></a> ① 执行上下文类型</h4><p><strong>（1）全局执行上下文</strong></p><p>任何不在函数内部的都是全局执行上下文，它首先会创建一个全局的window对象，并且设置this的值等于这个全局对象，一个程序中只有一个全局执行上下文。</p><p><strong>（2）函数执行上下文</strong></p><p>当一个函数被调用时，就会为该函数创建一个新的执行上下文，函数的上下文可以有任意多个。</p><p><strong>（3）</strong><code>**eval**</code><strong>函数执行上下文</strong></p><p>执行在eval函数中的代码会有属于他自己的执行上下文，不过eval函数不常使用，不做介绍。</p><h4 id="2-执行上下文栈"><a class="markdownIt-Anchor" href="#2-执行上下文栈"></a> ② 执行上下文栈</h4><ul><li>JavaScript引擎使用执行上下文栈来管理执行上下文</li><li>当JavaScript执行代码时，首先遇到全局代码，会创建一个全局执行上下文并且压入执行栈中，每当遇到一个函数调用，就会为该函数创建一个新的执行上下文并压入栈顶，引擎会执行位于执行上下文栈顶的函数，当函数执行完成之后，执行上下文从栈中弹出，继续执行下一个上下文。当所有的代码都执行完毕之后，从栈中弹出全局执行上下文。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let a = &#x27;Hello World!&#x27;;</span><br><span class="line">function first() &#123;</span><br><span class="line">  console.log(&#x27;Inside first function&#x27;);</span><br><span class="line">  second();</span><br><span class="line">  console.log(&#x27;Again inside first function&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">function second() &#123;</span><br><span class="line">  console.log(&#x27;Inside second function&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">first();</span><br><span class="line">//执行顺序</span><br><span class="line">//先执行second(),在执行first()</span><br></pre></td></tr></table></figure><h4 id="3-创建执行上下文"><a class="markdownIt-Anchor" href="#3-创建执行上下文"></a> ③ 创建执行上下文</h4><p>创建执行上下文有两个阶段：<strong>创建阶段</strong>和<strong>执行阶段</strong></p><p><strong>1）创建阶段</strong></p><p>（1）this绑定</p><ul><li>在全局执行上下文中，this指向全局对象（window对象）</li><li>在函数执行上下文中，this指向取决于函数如何调用。如果它被一个引用对象调用，那么 this 会被设置成那个对象，否则 this 的值被设置为全局对象或者 undefined</li></ul><p>（2）创建词法环境组件</p><ul><li>词法环境是一种有<strong>标识符——变量映射</strong>的数据结构，标识符是指变量/函数名，变量是对实际对象或原始数据的引用。</li><li>词法环境的内部有两个组件：<strong>加粗样式</strong>：环境记录器:用来储存变量个函数声明的实际位置<strong>外部环境的引用</strong>：可以访问父级作用域</li></ul><p>（3）创建变量环境组件</p><ul><li>变量环境也是一个词法环境，其环境记录器持有变量声明语句在执行上下文中创建的绑定关系。</li></ul><p><strong>2）执行阶段</strong></p><p>此阶段会完成对变量的分配，最后执行完代码。</p><p><strong>简单来说执行上下文就是指：</strong></p><p>在执行一点JS代码之前，需要先解析代码。解析的时候会先创建一个全局执行上下文环境，先把代码中即将执行的变量、函数声明都拿出来，变量先赋值为undefined，函数先声明好可使用。这一步执行完了，才开始正式的执行程序。</p><p>在一个函数执行之前，也会创建一个函数执行上下文环境，跟全局执行上下文类似，不过函数执行上下文会多出this、arguments和函数的参数。</p><ul><li>全局上下文：变量定义，函数声明</li><li>函数上下文：变量定义，函数声明，<code>this</code>，`arguments</li></ul>]]></content>
    
    
    <summary type="html">整理面试时提到过的知识点，学习java时没有留意的数据类型、js数据类型和闭包。</summary>
    
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/categories/Web/"/>
    
    <category term="JavaScript" scheme="https://www.kzmqvq.com/categories/Web/JavaScript/"/>
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/tags/Web/"/>
    
    <category term="前端" scheme="https://www.kzmqvq.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="随手记" scheme="https://www.kzmqvq.com/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
    <category term="JavaScript" scheme="https://www.kzmqvq.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>【随手记】Vue知识点</title>
    <link href="https://www.kzmqvq.com/posts/97bf29f1.html"/>
    <id>https://www.kzmqvq.com/posts/97bf29f1.html</id>
    <published>2022-09-17T12:11:36.000Z</published>
    <updated>2023-01-24T04:52:22.171Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>最近在做牛客的前端题库，将自己认知薄弱的一些知识点整理了下来，这是Vue的部分，包括Object.defineProoerty()、动态路由、webpack配置、keep-alive参数含义、watch监听等。</p><h2 id="vue知识点"><a class="markdownIt-Anchor" href="#vue知识点"></a> Vue知识点</h2><h3 id="客户端-服务端渲染的区别"><a class="markdownIt-Anchor" href="#客户端-服务端渲染的区别"></a> 客户端、服务端渲染的区别</h3><table><thead><tr><th></th><th>客户端渲染</th><th>服务端渲染</th></tr></thead><tbody><tr><td>html生成原理</td><td>由js生成html</td><td>由后台语言通过一些模版引擎生成</td></tr><tr><td>优点</td><td>1．前后端分离，前端做视图和交互，后端提供接口、数据<br>2．前端做路由；服务器计算压力变轻</td><td>1．响应快，用户体验好<br>2．搜索引擎友好，有seo优化<br>3．nodejs层服务器渲染，前端性能优化更顺手，可操作空间更大<br></td></tr><tr><td>缺点</td><td>用户等待时间变长，尤其是<strong>请求数多</strong>且有一定<strong>先后顺序</strong>的时候</td><td>1．增加服务器计算压力（虽可以做渲染缓存，但是毕竟多做了计算）<br>2．如果不是增加node中间层，前后端分工不明，不能很好的并行开发</td></tr><tr><td>耗时比较</td><td>1．数据请求：客户端在不同网络环境进行数据请求，外网http请求开销大，导致时间差<br>2．步骤：客户端需要等待js代码下载，加载完成再请求数据，渲染<br>3．渲染内容：客户端渲染，是经历一个从无到有完整的渲染步骤</td><td>1．数据请求：服务端在内网请求，数据响应速度快<br>2．步骤：服务端是先请求数据再渲染可视部分，即服务端不需要等待js代码下载，并会返回一个已经有内容的页面<br>3．渲染性能：服务端性能比客户端高，速度快<br>4．渲染内容：服务端先渲染可视部分，客户端再做二次渲染</td></tr><tr><td>适用场景</td><td>单页面应用如：React，Vue等等前端框架</td><td>用户体验比较高的比如首屏加载，重复较多的公共页面可以使用服务器渲染，减少ajax请求，挺升用户体验<br>如：<code>PHP</code>文件、<code>JSP</code>文件、Python的<code>Flask</code>配合Jinja引擎、<code>Django</code>框架、Java 配合vm模版引擎、<code>NodeJS</code>配合Jade。适合多页面应用。其实现在大部分网站 还是这种形式。</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">服务器端渲染有利于SEO，且首页加载快</span><br><span class="line">客户端渲染节省后端资源，但可能会加载慢出现白屏</span><br><span class="line">服务器端渲染耗费流量，局部页面的变化也需要重新请求完整的页面</span><br><span class="line"></span><br><span class="line">客户端和服务器端在首屏渲染上网络请求次数是一样的(×) 客户端两次 服务端一次 </span><br><span class="line">客户端首屏渲染时首先拿到空的html模板，之后继续发起数据请求。而服务器端渲染只需要请求一次，服务器会将请求的数据放在html模板中一起返回。</span><br></pre></td></tr></table></figure><h4 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h4><p>1．有点网站为了让单页面应用利于seo，会让服务器和客户端同构，使用React／Vue渲染的方案。</p><p>2．对于同一个组件，服务端渲染“可视”的一部分，为确保组件有完整的生命周期和事件处理，客户端需要再次渲染</p><p>3．服务端渲染实际也是需要客户端进行开销很小的二次渲染</p><h3 id="绑定的相关指令"><a class="markdownIt-Anchor" href="#绑定的相关指令"></a> 绑定的相关指令</h3><p><strong>v-model： 双向绑定</strong></p><ul><li>添加number修饰符：可以自动将用户的输入值转为数值类型，如果这个值无法被<code>parseFloat()</code>解析，则会<strong>返回原始的值</strong>；添加trim修饰符：自动过滤用户输入的首尾空白字符；添加lazy修饰符：让内容在“change”事件时而非“input”事件时更新。</li><li>本质上是语法糖，负责监听用户的输入事件以更新数据；如果为不同元素绑定数据，则使用不同元素property，并抛出不同的事件；在vue2.2+版本新增功能，可以在<strong>自定义组件上使用</strong>v-model实现双向绑定</li><li><code>双向数据绑定</code>：Vue实现双向数据绑定是采用数据劫持和发布者-订阅模式。数据劫持是利用ES5的<code>Object.defineProperty(obj, key, value)</code>方法来劫持每个属性的getter和setter。用户更新了View、Model的数据也自动被更新了，这种情况就是双向数据绑定。</li></ul><p><strong>v-on（@）：绑定事件</strong></p><p><strong>v-bind（:）： 绑定dom</strong></p><h3 id="获取动态路由中id的值"><a class="markdownIt-Anchor" href="#获取动态路由中id的值"></a> 获取动态路由中id的值</h3><p><code>&#123; path: '/name/:id' &#125;</code></p><p>router其实是VueRouter的一个实例，所以它是一个全局对象，包含了所有的子对象和属性。而route是正在跳转的这个路由的局部对象，可以获取这个正在跳转的路由的name，path，params，query等</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span><br></pre></td></tr></table></figure><h3 id="webpack配置的描述"><a class="markdownIt-Anchor" href="#webpack配置的描述"></a> webpack配置的描述</h3><ul><li><code>module.rules</code>可以指定多个loader，而loader的作用是对模块的源码进行转换</li><li>plugin是一个具有apply方法的JavaScript对象，由于plugin可以携带参数，所以必须在配置中向plugins属性传入一个实例</li><li>webpack开始处理程序时，从入口开始递归构建一个依赖关系图，包含了程序所需的模块，然后打包为少量的bundle，通常只有一个bundle</li><li><strong>模块热替换</strong>会在程序运行中，替换、添加、删除模块，<code>无需重新加载整个页面</code>，<code>无需更替所有模块</code>。</li></ul><h3 id="watch监听"><a class="markdownIt-Anchor" href="#watch监听"></a> watch监听</h3><p>使用watch <code>handler</code>属性有一个特点，就是当值第一次绑定时，watch不会执行监听函数，只有值发生改变时才会执行。</p><p>如果需要在最初绑定值的时候也执行函数，则就需要用到immediate属性，添加 immediate: true属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;, </span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: &#123;</span><br><span class="line">      <span class="attr">handler</span>: <span class="keyword">function</span>(<span class="params">value</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// immediate: true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>监听不会被发现</p><h3 id="路由模式"><a class="markdownIt-Anchor" href="#路由模式"></a> 路由模式</h3><ul><li>vue-router有两种模式，history和hash模式</li><li>hash模式是通过<code>onhashchange</code>事件，监听url的修改</li><li>history通过H5提供的API  history.pushState 和 history.pushState实现跳转且不刷新页面</li><li>history模式需要后端进行配合</li></ul><h3 id="vue响应式"><a class="markdownIt-Anchor" href="#vue响应式"></a> Vue响应式</h3><p><strong>Vue2无法检测property的添加或移除</strong>。由于Vue会在初始化实例时对property执行getter/setter转化，所以property必须在data对象上存在才能让Vue将它转换为响应式的。(这里声明是指vue2，在3.x的时候已经实现了深层对象和数组元素直接赋值、删除属性的响应式)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">form</span>: &#123;</span><br><span class="line">      <span class="attr">total</span>: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// this.form.total是响应式的</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 若直接增加属性，是非响应式的</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">showFlag</span>= <span class="literal">true</span>  <span class="comment">//非响应式的</span></span><br></pre></td></tr></table></figure><p>使用Vue.set(object, key, value)方法将响应属性添加到嵌套的对象上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">set</span>(<span class="variable language_">this</span>.<span class="property">form</span>, <span class="string">&#x27;showFlag&#x27;</span>, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>还可以使用vm.$set实例方法，这也是全局Vue.set方法的别名：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">form</span>, <span class="string">&#x27;showFlag&#x27;</span>, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">在牛客刷选择题时整理的知识点，包括Object.defineProoerty()、动态路由、webpack配置、keep-alive参数含义、watch监听等。</summary>
    
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/categories/Web/"/>
    
    <category term="Vue" scheme="https://www.kzmqvq.com/categories/Web/Vue/"/>
    
    
    <category term="Web" scheme="https://www.kzmqvq.com/tags/Web/"/>
    
    <category term="Vue" scheme="https://www.kzmqvq.com/tags/Vue/"/>
    
    <category term="前端" scheme="https://www.kzmqvq.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="随手记" scheme="https://www.kzmqvq.com/tags/%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>【项目总结】TypeScript基础</title>
    <link href="https://www.kzmqvq.com/posts/1c5c8a7f.html"/>
    <id>https://www.kzmqvq.com/posts/1c5c8a7f.html</id>
    <published>2022-09-06T13:56:52.000Z</published>
    <updated>2023-01-24T04:52:13.982Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>本篇博客用于补充在商城后台管理系统中出现的 <code>TypeScript</code> 知识点。</p><h2 id="知识整理"><a class="markdownIt-Anchor" href="#知识整理"></a> 知识整理</h2><p><code>TypeScript</code>解决了<code>JavaScript</code>存在的很多设计缺陷，尤其是关于类型检测的。从开发者长远的角度来看，学习<code>TypeScript</code>有助于前端程序员培养 类型思维，这种思维方式对于完成大型项目尤为重要。个人用起来感觉很像<code>Java</code>。</p><h3 id="typescript的特点"><a class="markdownIt-Anchor" href="#typescript的特点"></a> TypeScript的特点</h3><ul><li>始于JavaScript，归于JavaScript</li><li>TypeScript是一个强大的工具，用于构建大型项目<ul><li>类型允许JavaScript开发者在开发JavaScript应用程序时，使用高效的开发工具和常用操作，比如<mark class="hl-label blue">静态检查</mark> 和<mark class="hl-label blue">代码重构</mark> </li><li>类型是可选的，类型推断让一些类型的注释使你的代码的静态验证有很大的不同。类型让你<mark class="hl-label green">定义软件组件之间的接口</mark> 和洞察现有JavaScript库的行为；</li></ul></li><li>拥有先进的 JavaScript<ul><li>TypeScript提供最新的和不断发展的JavaScript特性，包括那些来自2015年的ECMAScript和未来的提案中的特性，比如异步功能和Decorators，以帮助<mark class="hl-label green">建立健壮的组件</mark> ；</li><li>这些特性为高可信应用程序开发时是可用的，但是会被编译成简洁的ECMAScript3（或更新版本）的JavaScript；(<code>babel</code>编译器的使用)</li></ul></li></ul><h3 id="变量声明"><a class="markdownIt-Anchor" href="#变量声明"></a> 变量声明</h3><p>在TypeScript中定义变量需要指定 标识符 的类型。声明了类型后TypeScript就会进行<mark class="hl-label blue">类型检测</mark> ，声明的类型可以称之为类型注解； 比如我们声明一个message，完整的写法如下：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&quot;Hello World&quot;</span></span><br></pre></td></tr></table></figure><p>如果我们在使用时赋值给<code>message</code>其他的类型，就会报错。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message1 = <span class="number">123</span> <span class="comment">// Type &#x27;message&#x27; is not assignable to type &#x27;string&#x27;</span></span><br></pre></td></tr></table></figure><p>在开发中，有时候为了方便起见我们并不会在声明每一个变量时都写上对应的数据类型，我们更希望可以通过TypeScript本身的特性帮助我们推断出对应的变量类型：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> message = <span class="string">&quot;Hello World&quot;</span></span><br><span class="line"><span class="comment">// 在一个变量第一次赋值时，ts会根据后面的赋值内容的类型，来推断出变量的类型</span></span><br><span class="line">message = <span class="number">123</span> <span class="comment">// // Type &#x27;message&#x27; is not assignable to type &#x27;string&#x27;</span></span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2022/09/06/e3aUzHWPL5mN6uo.png" alt="ts与js的关系" /></p><h3 id="数据类型"><a class="markdownIt-Anchor" href="#数据类型"></a> 数据类型</h3><p><code>TypeScript</code>在<code>JavaScript</code>的基础上新增了一些数据类型。</p><p><strong>any类型</strong></p><p>在某些情况下，我们确实无法确定一个变量的类型，并且可能它会发生一些变化，这个时候我们可以使用any类型（类似于Dart语言中的dynamic类型）；</p><p>any类型有点像一种讨巧的TypeScript手段：我们可以对any类型的变量进行任何的操作，包括获取不存在的属性、方法；赋值任何的值，比如数字、字符串的值。偷懒时可以这么干qvq</p><p><strong>unknown类型</strong></p><p>unknown是TypeScript中比较特殊的一种类型，它用于描述类型不确定的变量。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unknown类型只能赋值给any和unknown类型</span></span><br><span class="line"><span class="comment">// any类型可以赋值给任意类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flag = <span class="literal">true</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">unknown</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">  result = <span class="title function_">foo</span>()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  result = <span class="title function_">bar</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> result === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">length</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p><strong>void类型</strong></p><p>void通常用来指定一个没有返回值的函数； 如果一个函数我们没有写任何类型，那么它默认返回值的类型就是void，我们也可以显示的来指定返回值是void：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">num1: <span class="built_in">number</span>, num2: <span class="built_in">number</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(num1 + num2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">num1: <span class="built_in">number</span>, num2: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(num1 + num2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>never类型</strong></p><p>never 表示永远不会发生值的类型，以一个函数为例：</p><ul><li>如果一个函数中是一个死循环或者抛出一个异常，那么这个函数会返回东西吗？</li><li>不会，那么写void类型或者其他类型作为返回值类型都不合适，我们就可以使用never类型；</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="comment">// 死循环</span></span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="comment">// 抛出异常</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>tuple类型</strong></p><p>tuple是元组类型，很多语言中也有这种数据类型，比如Python、Swift等。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">info</span>: [<span class="built_in">string</span>, <span class="built_in">number</span>, <span class="built_in">number</span>] = [<span class="string">&quot;why&quot;</span>, <span class="number">18</span>, <span class="number">1.88</span>]</span><br><span class="line"><span class="keyword">const</span> name = info[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">const</span> age = info[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>tuple和数组有什么区别呢？</p><p>首先，数组中通常建议存放相同类型的元素，不同类型的元素是不推荐放在数组中。（可以放在对象或者元组中）其次，元组中每个元素都有自己特性的类型，根据索引值获取到的值可以确定对应的类型；</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">info</span>: (<span class="built_in">string</span> | <span class="built_in">number</span>)[] = [<span class="string">&quot;why&quot;</span>, <span class="number">18</span>, <span class="number">1.88</span>]</span><br><span class="line"><span class="keyword">const</span> item1 = info[<span class="number">0</span>] <span class="comment">// 不能确定类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">tinfo</span>: [<span class="built_in">string</span>, <span class="built_in">number</span>, <span class="built_in">number</span>] = [<span class="string">&quot;why&quot;</span>, <span class="number">18</span>, <span class="number">1.88</span>]</span><br><span class="line"><span class="keyword">const</span> item2 = tinfo[<span class="number">0</span>] <span class="comment">// 一定是string类型</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">项目笔记，coderwhy老师的前端课程，补充TypeScript基础知识点。</summary>
    
    
    
    <category term="项目总结" scheme="https://www.kzmqvq.com/categories/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="Vue3" scheme="https://www.kzmqvq.com/tags/Vue3/"/>
    
    <category term="项目总结" scheme="https://www.kzmqvq.com/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"/>
    
    <category term="笔记" scheme="https://www.kzmqvq.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="后台管理系统" scheme="https://www.kzmqvq.com/tags/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="TypeScript" scheme="https://www.kzmqvq.com/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>【项目总结】vue3-shop-cms</title>
    <link href="https://www.kzmqvq.com/posts/1b316398.html"/>
    <id>https://www.kzmqvq.com/posts/1b316398.html</id>
    <published>2022-09-02T12:27:28.000Z</published>
    <updated>2023-01-24T04:52:03.794Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>在完成基于 Vue3 和 TypeScript 的商城后台管理系统项目后，总结的学习笔记。项目原作者coderwhy</p><p><a href="https://github.com/bluehyssopu/vue3-shop-cms">项目地址</a> <a href="https://vue3admin.kzmqvq.com">在线演示</a></p><h2 id="知识点"><a class="markdownIt-Anchor" href="#知识点"></a> 知识点</h2><h3 id="表格时间格式化"><a class="markdownIt-Anchor" href="#表格时间格式化"></a> 表格时间格式化</h3><p>使用 Element-Plus 的表格组件时，用于规范用户管理的注册时间。将 <code>formatUtcString</code> 函数作为一个工具函数存放在<code>utils</code> 文件夹下，将其全局注册 <code>registerProperties</code>。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> utc <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/utc&#x27;</span></span><br><span class="line"></span><br><span class="line">dayjs.<span class="title function_">extend</span>(utc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DATE_TIME_FORMAT</span> = <span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">formatUtcString</span>(<span class="params"></span></span><br><span class="line"><span class="params">  utcString: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  format: <span class="built_in">string</span> = DATE_TIME_FORMAT</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> dayjs.<span class="title function_">utc</span>(utcString).<span class="title function_">utcOffset</span>(<span class="number">8</span>).<span class="title function_">format</span>(format)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; formatUtcString &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/date-format&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">registerProperties</span>(<span class="params">app: App</span>) &#123;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$filters</span> = &#123;</span><br><span class="line">    <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">formatTime</span>(<span class="params">value: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">formatUtcString</span>(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当使用表格组件时，借助列中的插槽进行 <code>formatTime</code> 处理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template #createAt=&quot;scope&quot;&gt;</span><br><span class="line">  &lt;span&gt;&#123;&#123; $filters.formatTime(scope.row.createAt) &#125;&#125;&lt;/span&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;template #updateAt=&quot;scope&quot;&gt;</span><br><span class="line">  &lt;span&gt;&#123;&#123; $filters.formatTime(scope.row.updateAt) &#125;&#125;&lt;/span&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="表格组件的封装"><a class="markdownIt-Anchor" href="#表格组件的封装"></a> 表格组件的封装</h3><ol><li>把表头、表格的内容、表格页码跳转作为表格的基本元素封装起来(base-ui/table)，代码结构如下</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2022/09/05/oz39r1gKcH8lRaZ.jpg" alt="table的封装.jpg" /></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;hy-table&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;el-table&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;div class=&quot;footer&quot; v-if=&quot;showFooter&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">...</span><br><span class="line">  &#125;,</span><br><span class="line">  emits: [&#x27;selectionChange&#x27;, &#x27;update:page&#x27;],</span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    const handleSelectionChange = (value: any) =&gt; &#123;</span><br><span class="line">      emit(&#x27;selectionChange&#x27;, value)</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      handleSelectionChange,</span><br><span class="line">  ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;less&quot;&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>完整代码如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;hy-table&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">      &lt;slot name=&quot;header&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;handler&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;headerHandler&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;listData&quot;</span><br><span class="line">      border</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;</span><br><span class="line">      v-bind=&quot;childrenProps&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        v-if=&quot;showSelectColumn&quot;</span><br><span class="line">        type=&quot;selection&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        width=&quot;60&quot;</span><br><span class="line">      &gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        v-if=&quot;showIndexColumn&quot;</span><br><span class="line">        type=&quot;index&quot;</span><br><span class="line">        label=&quot;序号&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        width=&quot;80&quot;</span><br><span class="line">      &gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;template v-for=&quot;propItem in propList&quot; :key=&quot;propItem.prop&quot;&gt;</span><br><span class="line">        &lt;el-table-column v-bind=&quot;propItem&quot; align=&quot;center&quot; show-overflow-tooltip&gt;</span><br><span class="line">          &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">            &lt;slot :name=&quot;propItem.slotName&quot; :row=&quot;scope.row&quot;&gt;</span><br><span class="line">              &#123;&#123; scope.row[propItem.prop] &#125;&#125;</span><br><span class="line">            &lt;/slot&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;div class=&quot;footer&quot; v-if=&quot;showFooter&quot;&gt;</span><br><span class="line">      &lt;slot name=&quot;footer&quot;&gt;</span><br><span class="line">        &lt;el-pagination</span><br><span class="line">          @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">          @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">          :current-page=&quot;page.currentPage&quot;</span><br><span class="line">          :page-size=&quot;page.pageSize&quot;</span><br><span class="line">          :page-sizes=&quot;[10, 20, 30]&quot;</span><br><span class="line">          layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">          :total=&quot;listCount&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/el-pagination&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    listData: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;,</span><br><span class="line">    listCount: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      default: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    propList: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;,</span><br><span class="line">    showIndexColumn: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    showSelectColumn: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    page: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      default: () =&gt; (&#123; currentPage: 0, pageSize: 10 &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    childrenProps: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      default: () =&gt; (&#123;&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    showFooter: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  emits: [&#x27;selectionChange&#x27;, &#x27;update:page&#x27;],</span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    const handleSelectionChange = (value: any) =&gt; &#123;</span><br><span class="line">      emit(&#x27;selectionChange&#x27;, value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const handleCurrentChange = (currentPage: number) =&gt; &#123;</span><br><span class="line">      emit(&#x27;update:page&#x27;, &#123; ...props.page, currentPage &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const handleSizeChange = (pageSize: number) =&gt; &#123;</span><br><span class="line">      emit(&#x27;update:page&#x27;, &#123; ...props.page, pageSize &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      handleSelectionChange,</span><br><span class="line">      handleCurrentChange,</span><br><span class="line">      handleSizeChange</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;less&quot;&gt;</span><br><span class="line">.header &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  height: 45px;</span><br><span class="line">  padding: 0 5px;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line"></span><br><span class="line">  .title &#123;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">    font-weight: 700;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .handler &#123;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.footer &#123;</span><br><span class="line">  margin-top: 15px;</span><br><span class="line"></span><br><span class="line">  .el-pagination &#123;</span><br><span class="line">    text-align: right;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>由于页面内容的重合(用户管理表、商品管理表、角色管理表、菜单管理表等)，把页面内容的呈现作为第二层封装(components/page-content)。具体表现在 是否选中(index)、编号(id)、创建和编辑按钮等。代码结构如下</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;page-content&quot;&gt;</span><br><span class="line">    &lt;hy-table</span><br><span class="line">      :listData=&quot;dataList&quot;</span><br><span class="line">      :listCount=&quot;dataCount&quot;</span><br><span class="line">      v-bind=&quot;contentTableConfig&quot;</span><br><span class="line">      v-model:page=&quot;pageInfo&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 1.header中的插槽 --&gt;</span><br><span class="line">      &lt;template #headerHandler&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 2.列中的插槽 --&gt;</span><br><span class="line">      &lt;template #status=&quot;scope&quot;&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;template #createAt=&quot;scope&quot;&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;template #updateAt=&quot;scope&quot;&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;template #handler=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;handle-btns&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 在page-content中动态插入剩余的插槽 --&gt;</span><br><span class="line">      &lt;template</span><br><span class="line">        v-for=&quot;item in otherPropSlots&quot;</span><br><span class="line">        :key=&quot;item.prop&quot;</span><br><span class="line">        #[item.slotName]=&quot;scope&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template v-if=&quot;item.slotName&quot;&gt;</span><br><span class="line">          &lt;slot :name=&quot;item.slotName&quot; :row=&quot;scope.row&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/hy-table&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, computed, ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;@/store&#x27;</span><br><span class="line">import &#123; usePermission &#125; from &#x27;@/hooks/use-permission&#x27;</span><br><span class="line"></span><br><span class="line">import HyTable from &#x27;@/base-ui/table&#x27;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    HyTable</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  emits: [&#x27;newBtnClick&#x27;, &#x27;editBtnClick&#x27;],</span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    const store = useStore()</span><br><span class="line"></span><br><span class="line">    // 0.获取操作的权限</span><br><span class="line">    const isCreate = usePermission(props.pageName, &#x27;create&#x27;)</span><br><span class="line">    const isUpdate = usePermission(props.pageName, &#x27;update&#x27;)</span><br><span class="line">    const isDelete = usePermission(props.pageName, &#x27;delete&#x27;)</span><br><span class="line">    const isQuery = usePermission(props.pageName, &#x27;query&#x27;)</span><br><span class="line"></span><br><span class="line">    // 1.双向绑定pageInfo</span><br><span class="line">    const pageInfo = ref(&#123; currentPage: 1, pageSize: 10 &#125;)</span><br><span class="line">    watch(pageInfo, () =&gt; getPageData())</span><br><span class="line"></span><br><span class="line">    // 2.发送网络请求</span><br><span class="line">    const getPageData = (queryInfo: any = &#123;&#125;) =&gt; &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    getPageData()</span><br><span class="line"></span><br><span class="line">    // 3.从vuex中获取数据</span><br><span class="line">    const dataList = computed(() =&gt;</span><br><span class="line">      store.getters[`system/pageListData`](props.pageName)</span><br><span class="line">    )</span><br><span class="line">    const dataCount = computed(() =&gt;</span><br><span class="line">      store.getters[`system/pageListCount`](props.pageName)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    // 4.获取其他的动态插槽名称</span><br><span class="line">    const otherPropSlots = props.contentTableConfig?.propList.filter(</span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    // 5.删除/编辑/新建操作</span><br><span class="line">    const handleDeleteClick = (item: any) =&gt; &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    const handleNewClick = () =&gt; &#123;</span><br><span class="line">      emit(&#x27;newBtnClick&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    const handleEditClick = (item: any) =&gt; &#123;</span><br><span class="line">      emit(&#x27;editBtnClick&#x27;, item)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      dataList,</span><br><span class="line">      getPageData,</span><br><span class="line">      dataCount,</span><br><span class="line">      pageInfo,</span><br><span class="line">      otherPropSlots,</span><br><span class="line">      isCreate,</span><br><span class="line">      isUpdate,</span><br><span class="line">      isDelete,</span><br><span class="line">      handleDeleteClick,</span><br><span class="line">      handleNewClick,</span><br><span class="line">      handleEditClick</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>完整代码如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;page-content&quot;&gt;</span><br><span class="line">    &lt;hy-table</span><br><span class="line">      :listData=&quot;dataList&quot;</span><br><span class="line">      :listCount=&quot;dataCount&quot;</span><br><span class="line">      v-bind=&quot;contentTableConfig&quot;</span><br><span class="line">      v-model:page=&quot;pageInfo&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 1.header中的插槽 --&gt;</span><br><span class="line">      &lt;template #headerHandler&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;isCreate&quot;</span><br><span class="line">          type=&quot;primary&quot;</span><br><span class="line">          size=&quot;medium&quot;</span><br><span class="line">          @click=&quot;handleNewClick&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          新建用户</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 2.列中的插槽 --&gt;</span><br><span class="line">      &lt;template #status=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          plain</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          :type=&quot;scope.row.enable ? &#x27;success&#x27; : &#x27;danger&#x27;&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123; scope.row.enable ? &#x27;启用&#x27; : &#x27;禁用&#x27; &#125;&#125;</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">      &lt;template #createAt=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; $filters.formatTime(scope.row.createAt) &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">      &lt;template #updateAt=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; $filters.formatTime(scope.row.updateAt) &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">      &lt;template #handler=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;handle-btns&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;isUpdate&quot;</span><br><span class="line">            icon=&quot;el-icon-edit&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            @click=&quot;handleEditClick(scope.row)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            编辑</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;isDelete&quot;</span><br><span class="line">            icon=&quot;el-icon-delete&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            @click=&quot;handleDeleteClick(scope.row)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 在page-content中动态插入剩余的插槽 --&gt;</span><br><span class="line">      &lt;template</span><br><span class="line">        v-for=&quot;item in otherPropSlots&quot;</span><br><span class="line">        :key=&quot;item.prop&quot;</span><br><span class="line">        #[item.slotName]=&quot;scope&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template v-if=&quot;item.slotName&quot;&gt;</span><br><span class="line">          &lt;slot :name=&quot;item.slotName&quot; :row=&quot;scope.row&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/hy-table&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; defineComponent, computed, ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;@/store&#x27;</span><br><span class="line">import &#123; usePermission &#125; from &#x27;@/hooks/use-permission&#x27;</span><br><span class="line"></span><br><span class="line">import HyTable from &#x27;@/base-ui/table&#x27;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    HyTable</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    contentTableConfig: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      require: true</span><br><span class="line">    &#125;,</span><br><span class="line">    pageName: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  emits: [&#x27;newBtnClick&#x27;, &#x27;editBtnClick&#x27;],</span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    const store = useStore()</span><br><span class="line"></span><br><span class="line">    // 0.获取操作的权限</span><br><span class="line">    const isCreate = usePermission(props.pageName, &#x27;create&#x27;)</span><br><span class="line">    const isUpdate = usePermission(props.pageName, &#x27;update&#x27;)</span><br><span class="line">    const isDelete = usePermission(props.pageName, &#x27;delete&#x27;)</span><br><span class="line">    const isQuery = usePermission(props.pageName, &#x27;query&#x27;)</span><br><span class="line"></span><br><span class="line">    // 1.双向绑定pageInfo</span><br><span class="line">    const pageInfo = ref(&#123; currentPage: 1, pageSize: 10 &#125;)</span><br><span class="line">    watch(pageInfo, () =&gt; getPageData())</span><br><span class="line"></span><br><span class="line">    // 2.发送网络请求</span><br><span class="line">    const getPageData = (queryInfo: any = &#123;&#125;) =&gt; &#123;</span><br><span class="line">      if (!isQuery) return</span><br><span class="line">      store.dispatch(&#x27;system/getPageListAction&#x27;, &#123;</span><br><span class="line">        pageName: props.pageName,</span><br><span class="line">        queryInfo: &#123;</span><br><span class="line">          offset: (pageInfo.value.currentPage - 1) * pageInfo.value.pageSize,</span><br><span class="line">          size: pageInfo.value.pageSize,</span><br><span class="line">          ...queryInfo</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    getPageData()</span><br><span class="line"></span><br><span class="line">    // 3.从vuex中获取数据</span><br><span class="line">    const dataList = computed(() =&gt;</span><br><span class="line">      store.getters[`system/pageListData`](props.pageName)</span><br><span class="line">    )</span><br><span class="line">    const dataCount = computed(() =&gt;</span><br><span class="line">      store.getters[`system/pageListCount`](props.pageName)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    // 4.获取其他的动态插槽名称</span><br><span class="line">    const otherPropSlots = props.contentTableConfig?.propList.filter(</span><br><span class="line">      (item: any) =&gt; &#123;</span><br><span class="line">        if (item.slotName === &#x27;status&#x27;) return false</span><br><span class="line">        if (item.slotName === &#x27;createAt&#x27;) return false</span><br><span class="line">        if (item.slotName === &#x27;updateAt&#x27;) return false</span><br><span class="line">        if (item.slotName === &#x27;handler&#x27;) return false</span><br><span class="line">        return true</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    // 5.删除/编辑/新建操作</span><br><span class="line">    const handleDeleteClick = (item: any) =&gt; &#123;</span><br><span class="line">      console.log(item)</span><br><span class="line">      store.dispatch(&#x27;system/deletePageDataAction&#x27;, &#123;</span><br><span class="line">        pageName: props.pageName,</span><br><span class="line">        id: item.id</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    const handleNewClick = () =&gt; &#123;</span><br><span class="line">      emit(&#x27;newBtnClick&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    const handleEditClick = (item: any) =&gt; &#123;</span><br><span class="line">      emit(&#x27;editBtnClick&#x27;, item)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      dataList,</span><br><span class="line">      getPageData,</span><br><span class="line">      dataCount,</span><br><span class="line">      pageInfo,</span><br><span class="line">      otherPropSlots,</span><br><span class="line">      isCreate,</span><br><span class="line">      isUpdate,</span><br><span class="line">      isDelete,</span><br><span class="line">      handleDeleteClick,</span><br><span class="line">      handleNewClick,</span><br><span class="line">      handleEditClick</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.page-content &#123;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  border-top: 20px solid #f5f5f5;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>在各种表格页面使用，以 <code>user.vue</code> 页面为例</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://vip2.loli.io/2022/09/05/evYNpOWnHmZPGds.jpg" alt="user页面的使用.jpg" /></p>]]></content>
    
    
    <summary type="html">项目笔记，coderwhy老师的前端课程，基于 Vue3 和 TypeScript 的后台管理系统。</summary>
    
    
    
    <category term="项目总结" scheme="https://www.kzmqvq.com/categories/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="Vue3" scheme="https://www.kzmqvq.com/tags/Vue3/"/>
    
    <category term="项目总结" scheme="https://www.kzmqvq.com/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"/>
    
    <category term="笔记" scheme="https://www.kzmqvq.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="后台管理系统" scheme="https://www.kzmqvq.com/tags/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
</feed>
